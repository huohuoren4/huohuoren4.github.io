import{_ as s,o as e,c as a,X as n}from"./chunks/framework.b5656a4e.js";const u=JSON.parse('{"title":"Functions","description":"","frontmatter":{},"headers":[],"relativePath":"python/pytest/reference_guides/api_reference/functions.md","filePath":"python/pytest/reference_guides/api_reference/functions.md","lastUpdated":1692807718000}'),o={name:"python/pytest/reference_guides/api_reference/functions.md"},l=n(`<h1 id="functions" tabindex="-1">Functions <a class="header-anchor" href="#functions" aria-label="Permalink to &quot;Functions {#functions}&quot;">​</a></h1><h2 id="pytest-approx" tabindex="-1">pytest.approx <a class="header-anchor" href="#pytest-approx" aria-label="Permalink to &quot;pytest.approx {#pytest-approx}&quot;">​</a></h2><ul><li><p><strong>approx</strong>(<code>expected, rel=None, abs=None, nan_ok=False</code>)</p><p>Assert that two numbers (or two ordered sequences of numbers) are equal to each other within some tolerance.</p><p>Due to the <a href="https://docs.python.org/3/tutorial/floatingpoint.html" target="_blank" rel="noreferrer">Floating Point Arithmetic: Issues and Limitations</a>, numbers that we would intuitively expect to be equal are not always so:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.3</span></span>
<span class="line"><span style="color:#FFCB6B;">False</span></span></code></pre></div><p>This problem is commonly encountered when writing tests, e.g. when making sure that floating-point values are what you expect them to be. One way to deal with this problem is to assert that two floating-point numbers are equal to within some appropriate tolerance:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">abs((0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;">) - 0.3) </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> 1e-6</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>However, comparisons like this are tedious to write and difficult to understand. Furthermore, absolute comparisons like the one above are usually discouraged because there’s no tolerance that works well for all situations. <code>1e-6</code> is good for numbers around <code>1</code>, but too small for very big numbers and too big for very small ones. It’s better to express the tolerance as a fraction of the expected value, but relative comparisons like that are even more difficult to write correctly and concisely.</p><p>The <code>approx</code> class performs floating-point comparisons using a syntax that’s as intuitive as possible:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0.3</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>The same syntax also works for ordered sequences of numbers:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.4</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> == </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">((</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p><code>numpy</code> arrays:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">numpy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">np</span><span style="color:#A6ACCD;">                                                          </span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">np.array([0.1,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#C3E88D;">]</span><span style="color:#A6ACCD;">) + np.array</span><span style="color:#89DDFF;">([</span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0.4</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> == approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">np.array([0.3,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.6</span><span style="color:#C3E88D;">]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">) </span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>And for a <code>numpy</code> array against a scalar:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">numpy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">np</span><span style="color:#A6ACCD;">                                         </span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">np.array([0.1,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#C3E88D;">]</span><span style="color:#A6ACCD;">) + np.array</span><span style="color:#89DDFF;">([</span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0.1</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> == approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0.3</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>Only ordered sequences are supported, because <code>approx</code> needs to infer the relative position of the sequences without ambiguity. This means <code>sets</code> and other unordered sequences are not supported.</p><p>Finally, dictionary values can also be compared:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">&#39;a&#39;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.4</span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">{&#39;a&#39;: 0.3, &#39;b&#39;: 0.6})</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>The comparison will be true if both mappings have the same keys and their respective values match the expected tolerances.</p><p><em>Tolerances</em></p><p>By default, <code>approx</code> considers numbers within a relative tolerance of <code>1e-6</code> (i.e. one part in a million) of its expected value to be equal. This treatment would lead to surprising results if the expected value was <code>0.0</code>, because nothing but <code>0.0</code> itself is relatively close to 0.0. To handle this case less surprisingly, <code>approx</code> also considers numbers within an absolute tolerance of <code>1e-12</code> of its expected value to be equal. Infinity and NaN are special cases. Infinity is only considered equal to itself, regardless of the relative tolerance. NaN is not considered equal to anything by default, but you can make it be equal to itself by setting the <code>nan_ok</code> argument to True. (This is meant to facilitate comparing arrays that use NaN to mean “no data”.)</p><p>Both the relative and absolute tolerances can be changed by passing arguments to the <code>approx</code> constructor:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">1.0001</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">False</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">1.0001</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rel=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-3</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">1.0001</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">abs=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-3</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>If you specify <code>abs</code> but not <code>rel</code>, the comparison will not consider the relative tolerance at all. In other words, two numbers that are within the default relative tolerance of <code>1e-6</code> will still be considered unequal if they exceed the specified absolute tolerance. If you specify both <code>abs</code> and <code>rel</code>, the numbers will be considered equal if either tolerance is met:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">abs=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-12</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">False</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rel=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-6,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">abs=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-12</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span></code></pre></div><p>You can also use <code>approx</code> to compare nonnumeric types, or dicts and sequences containing nonnumeric types, in which case it falls back to strict equality. This can be useful for comparing dicts and sequences that can contain optional values:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">&quot;required&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0000005</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">optional</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">None}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">{&quot;required&quot;: 1, &quot;optional&quot;: None})</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">None, </span><span style="color:#F78C6C;">1.0000005</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> == </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">None,1</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">foo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">1.0000005</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> == </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">None,1</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#FFCB6B;">False</span></span></code></pre></div><p>If you’re thinking about using <code>approx</code>, then you might want to know how it compares to other good ways of comparing floating-point numbers. All of these algorithms are based on relative and absolute tolerances and should agree for the most part, but they do have meaningful differences:</p><ul><li><p><code>math.isclose(a, b, rel_tol=1e-9, abs_tol=0.0)</code>: True if the relative tolerance is met w.r.t. either a or b or if the absolute tolerance is met. Because the relative tolerance is calculated w.r.t. both a and b, this test is symmetric (i.e. neither a nor b is a “reference value”). You have to specify an absolute tolerance if you want to compare to <code>0.0</code> because there is no tolerance by default. More information: <code>math.isclose()</code>.</p></li><li><p><code>numpy.isclose(a, b, rtol=1e-5, atol=1e-8)</code>: True if the difference between a and b is less that the sum of the relative tolerance w.r.t. b and the absolute tolerance. Because the relative tolerance is only calculated w.r.t. b, this test is asymmetric and you can think of b as the reference value. Support for comparing sequences is provided by <code>numpy.allclose()</code>. More information: <code>numpy.isclose</code>.</p></li><li><p><code>unittest.TestCase.assertAlmostEqual(a, b)</code>: True if a and b are within an absolute tolerance of <code>1e-7</code>. No relative tolerance is considered , so this function is not appropriate for very large or very small numbers. Also, it’s only available in subclasses of <code>unittest.TestCase</code> and it’s ugly because it doesn’t follow PEP8. More information: <code>unittest.TestCase.assertAlmostEqual()</code>.</p></li><li><p><code>a == pytest.approx(b, rel=1e-6, abs=1e-12)</code>: True if the relative tolerance is met w.r.t. b or if the absolute tolerance is met. Because the relative tolerance is only calculated w.r.t. b, this test is asymmetric and you can think of b as the reference value. In the special case that you explicitly specify an absolute tolerance but not a relative tolerance, only the absolute tolerance is considered.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p><code>approx</code> can handle numpy arrays, but we recommend the specialised test helpers in <a href="https://numpy.org/doc/stable/reference/routines.testing.html" target="_blank" rel="noreferrer">Test Support (numpy.testing)</a> if you need support for comparisons, NaNs, or ULP-based tolerances.</p><p>To match strings using regex, you can use <code>Matches</code> from the <a href="https://github.com/asottile/re-assert" target="_blank" rel="noreferrer">re_assert package</a>.</p></div><div class="warning custom-block"><p class="custom-block-title">Warning</p><p><em>Changed in version 3.2.</em></p><p>In order to avoid inconsistent behavior, <code>TypeError</code> is raised for <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code> and <code>&lt;=</code> comparisons. The example below illustrates the problem:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0.1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-10</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># calls approx(0.1).__gt__(0.1 + 1e-10)</span></span>
<span class="line"><span style="color:#FFCB6B;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">e-10</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">approx</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0.1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># calls approx(0.1).__lt__(0.1 + 1e-10)</span></span></code></pre></div><p>In the second example one expects <code>approx(0.1).__le__(0.1 + 1e-10)</code> to be called. But instead, <code>approx(0.1).__lt__(0.1 + 1e-10)</code> is used to comparison. This is because the call hierarchy of rich comparisons follows a fixed behavior. More information: <code>object.__ge__()</code></p></div><p><em>Changed in version 3.7.1</em>: <code>approx</code> raises <code>TypeError</code> when it encounters a dict value or sequence element of nonnumeric type.</p><p><em>Changed in version 6.1.0</em>: <code>approx</code> falls back to strict equality for nonnumeric types instead of raising <code>TypeError</code>.</p></li></ul><h2 id="pytest-fail" tabindex="-1">pytest.fail <a class="header-anchor" href="#pytest-fail" aria-label="Permalink to &quot;pytest.fail {#pytest-fail}&quot;">​</a></h2><p><em>Tutorial</em>: <a href="/python/pytest/how_to_guides/skip_xfail#how-to-use-skip-and-xfail-to-deal-with-tests-that-cannot-succeed">How to use skip and xfail to deal with tests that cannot succeed</a></p><ul><li><p><strong>fail</strong>(<code>reason[, pytrace=True, msg=None]</code>)</p><p>Explicitly fail an executing test with the given message.</p><p><em>Parameters</em>:</p><ul><li><p><code>reason (str)</code> – The message to show the user as reason for the failure.</p></li><li><p><code>pytrace (bool)</code> – If False, msg represents the full failure information and no python traceback will be reported.</p></li><li><p><code>python (Optional[str])</code> – Same as <code>reason</code>, but deprecated. Will be removed in a future version, use <code>reason</code> instead.</p></li></ul></li></ul><h2 id="pytest-skip" tabindex="-1">pytest.skip <a class="header-anchor" href="#pytest-skip" aria-label="Permalink to &quot;pytest.skip {#pytest-skip}&quot;">​</a></h2><ul><li><p><strong>skip</strong>(<code>reason[, allow_module_level=False, msg=None]</code>)</p><p>Skip an executing test with the given message.</p><p>This function should be called only during testing (setup, call or teardown) or during collection by using the <code>allow_module_level</code> flag. This function can be called in doctests as well.</p><p><em>Parameters</em>:</p><ul><li><p><code>reason (str)</code> – The message to show the user as reason for the skip.</p></li><li><p><code>allow_module_level (bool)</code> – Allows this function to be called at module level. Raising the skip exception at module level will stop the execution of the module and prevent the collection of all tests in the module, even those defined before the <code>skip</code> call. Defaults to False.</p></li><li><p><code>msg (Optional[str])</code> – Same as <code>reason</code>, but deprecated. Will be removed in a future version, use <code>reason</code> instead.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>It is better to use the <code>pytest.mark.skipif</code>) marker when possible to declare a test to be skipped under certain conditions like mismatching platforms or dependencies. Similarly, use the <code># doctest: +SKIP</code> directive (see <code>doctest.SKIP</code>) to skip a doctest statically.</p></div></li></ul><h2 id="pytest-importorskip" tabindex="-1">pytest.importorskip <a class="header-anchor" href="#pytest-importorskip" aria-label="Permalink to &quot;pytest.importorskip {#pytest-importorskip}&quot;">​</a></h2><ul><li><p><strong>importorskip</strong>(<code>modname, minversion=None, reason=None</code>)</p><p>Import and return the requested module <code>modname</code>, or skip the current test if the module cannot be imported.</p><p><em>Parameters</em>:</p><ul><li><p><code>modname (str)</code> – The name of the module to import.</p></li><li><p><code>minversion (Optional[str])</code> – If given, the imported module’s <code>__version__</code> attribute must be at least this minimal version, otherwise the test is still skipped.</p></li><li><p><code>reason (Optional[str])</code> – If given, this reason is shown as the message when the module cannot be imported.</p></li></ul><p><em>Returns</em>: The imported module. This should be assigned to its canonical name.</p><p><em>Return type</em>: <code>Any</code></p><p><em>Example</em>:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docutils</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.importorskip</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;docutils&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div></li></ul><h2 id="pytest-xfail" tabindex="-1">pytest.xfail <a class="header-anchor" href="#pytest-xfail" aria-label="Permalink to &quot;pytest.xfail {#pytest-xfail}&quot;">​</a></h2><ul><li><p><strong>xfail</strong>(<code>reason=&#39;&#39;</code>)</p><p>Imperatively xfail an executing test or setup function with the given reason.</p><p>This function should be called only during testing (setup, call or teardown).</p><p><em>Parameters</em>:</p><ul><li><code>reason (str)</code> – The message to show the user as reason for the xfail.</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>It is better to use the <code>pytest.mark.xfail</code> marker when possible to declare a test to be xfailed under certain conditions like known bugs or missing features.</p></div></li></ul><h2 id="pytest-exit" tabindex="-1">pytest.exit <a class="header-anchor" href="#pytest-exit" aria-label="Permalink to &quot;pytest.exit {#pytest-exit}&quot;">​</a></h2><ul><li><p><strong>exit</strong>(<code>reason[, returncode=False, msg=None]</code>)</p><p>Exit testing process.</p><p><em>Parameters</em>:</p><ul><li><p><code>reason (str)</code> – The message to show as the reason for exiting pytest. reason has a default value only because <code>msg</code> is deprecated.</p></li><li><p><code>returncode (Optional[int])</code> – Return code to be used when exiting pytest.</p></li><li><p><code>msg (Optional[str])</code> – Same as <code>reason</code>, but deprecated. Will be removed in a future version, use <code>reason</code> instead.</p></li></ul></li></ul><h2 id="pytest-main" tabindex="-1">pytest.main <a class="header-anchor" href="#pytest-main" aria-label="Permalink to &quot;pytest.main {#pytest-main}&quot;">​</a></h2><ul><li><p><strong>main</strong>(<code>args=None, plugins=None</code>)</p><p>Perform an in-process test run.</p><p><em>Parameters</em>:</p><ul><li><p><code>args (Optional[Union[List[str], PathLike[str]]])</code> – List of command line arguments. If <code>None</code> or not given, defaults to reading arguments directly from the process command line (<code>sys.argv</code>).</p></li><li><p><code>plugins (Optional[Sequence[Union[str, object]]])</code> – List of plugin objects to be auto-registered during initialization.</p></li></ul><p><em>Returns</em>: An exit code.</p><p><em>Return type</em>: <code>Union[int, ExitCode]</code></p></li></ul><h2 id="pytest-param" tabindex="-1">pytest.param <a class="header-anchor" href="#pytest-param" aria-label="Permalink to &quot;pytest.param {#pytest-param}&quot;">​</a></h2><ul><li><p><strong>param</strong>(<code>*values[, id][, marks]</code>)</p><p>Specify a parameter in <code>pytest.mark.parametrize</code> calls or <a href="/python/pytest/how_to_guides/fixture#using-marks-with-parametrized-fixtures">parametrized fixtures</a>.</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">pytest</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mark</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parametrize</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test_input,expected</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3+5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">        pytest</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">param</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">6*9</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">42</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">marks</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">pytest</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mark</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">xfail</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_eval</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">test_input</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">expected</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">eval</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">test_input</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> expected</span></span></code></pre></div><p><em>Parameters</em>:</p><ul><li><p><code>values (object)</code> – Variable args of the values of the parameter set, in order.</p></li><li><p><code>marks (Union[MarkDecorator, Collection[Union[MarkDecorator, Mark]]])</code> – A single mark or a list of marks to be applied to this parameter set.</p></li><li><p><code>id (Optional[str])</code> – The id to attribute to this parameter set.</p></li></ul></li></ul><h2 id="pytest-raises" tabindex="-1">pytest.raises <a class="header-anchor" href="#pytest-raises" aria-label="Permalink to &quot;pytest.raises {#pytest-raises}&quot;">​</a></h2><p><em>Tutorial</em>: <a href="https://docs.pytest.org/en/latest/how-to/assert.html#assertraises" target="_blank" rel="noreferrer">Assertions about expected exceptions</a></p><ul><li><p><code>with</code> <strong>raises</strong>(<code>expected_exception: Union[Type[E], Tuple[Type[E], ...]], *, match: Optional[Union[str, Pattern[str]]] = ...</code>) → <code>RaisesContext[E] as excinfo</code></p></li><li><p><code>with</code> <strong>raises</strong>(<code>expected_exception: Union[Type[E], Tuple[Type[E], ...]], func: Callable[[...], Any], *args: Any, **kwargs: Any</code>) → <code>ExceptionInfo[E] as excinfo</code></p><p>Assert that a code block/function call raises an exception.</p><p><em>Parameters</em>:</p><ul><li><p><code>expected_exception (Type[E] | Tuple[Type[E], ...])</code> – The expected exception type, or a tuple if one of multiple possible exception types are expected.</p></li><li><p><code>match (str | Pattern[str] | None)</code> – If specified, a string containing a regular expression, or a regular expression object, that is tested against the string representation of the exception ande its <code>PEP-678 &lt;https://peps.python.org/pep-0678/&gt; __notes__</code> using <code>re.search()</code>.</p></li></ul><p>To match a literal string that may contain <a href="https://docs.python.org/3/library/re.html#re-syntax" target="_blank" rel="noreferrer">special characters</a>, the pattern can first be escaped with <code>re.escape()</code>. (This is only used when <code>pytest.raises()</code> is used as a context manager, and passed through to the function otherwise. When using <code>pytest.raises()</code> as a function, you can use: <code>pytest.raises(Exc, func, match=&quot;passed on&quot;).match(&quot;my pattern&quot;).)</code></p><p>Use <code>pytest.raises</code> as a context manager, which will capture the exception of the given type:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ZeroDivisionError</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/0</span></span></code></pre></div><p>If the code block does not raise the expected exception (<code>ZeroDivisionError</code> in the example above), or no exception at all, the check will fail instead.</p><p>You can also use the keyword argument <code>match</code> to assert that the exception matches a text or regex:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ValueError,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">match=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">must be 0 or None</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;value must be 0 or None&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ValueError,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">match=r</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">must be \\d+$</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;value must be 42&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>The <code>match</code> argument searches the formatted exception string, which includes any <code>PEP-678 &lt;https://peps.python.org/pep-0678/&gt; __notes__</code>:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ValueError,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">match=r</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">had a note added</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;value must be 42&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">e.add_note</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;had a note added&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">e</span></span></code></pre></div><p>The context manager produces an <code>ExceptionInfo</code> object which can be used to inspect the details of the captured exception:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ValueError</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;value must be 42&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info.type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info.value.args[</span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">value must be 42</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>When using <code>pytest.raises</code> as a context manager, it’s worthwhile to note that normal context manager rules apply and that the exception raised must be the final line in the scope of the context manager. Lines of code after that, within the scope of the context manager will not be executed. For example:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ValueError</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;value must be &lt;= 10&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info.type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># this will not execute</span></span></code></pre></div><ul><li>Instead, the following approach must be taken (note the difference in scope):</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.raises</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ValueError</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">raise</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;value must be &lt;= 10&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exc_info.type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ValueError</span></span></code></pre></div></div><p>Using with <code>pytest.mark.parametrize</code></p><p>When using <code>pytest.mark.parametrize</code> it is possible to parametrize tests such that some runs raise an exception and others do not.</p><p>See <a href="/python/pytest/further_topics/example_trick/parametrize#parametrizing-conditional-raising">Parametrizing conditional raising</a> for an example.</p><p><em>Legacy form</em></p><p>It is possible to specify a callable by passing a to-be-called lambda:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">raises(ZeroDivisionError,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lambda:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">ExceptionInfo ...</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>or you can specify an arbitrary callable with arguments:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">f</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">x</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/x</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">raises(ZeroDivisionError,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">f,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">ExceptionInfo ...</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">raises(ZeroDivisionError,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">f,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">x=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">ExceptionInfo ...</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>The form above is fully supported but discouraged for new code because the context manager form is regarded as more readable and less error-prone.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Similar to caught exception objects in Python, explicitly clearing local references to returned <code>ExceptionInfo</code> objects can help the Python interpreter speed up its garbage collection.</p><p>Clearing those references breaks a reference cycle (<code>ExceptionInfo</code> –&gt; caught exception –&gt; frame stack raising the exception –&gt; current frame stack –&gt; local variables –&gt; <code>ExceptionInfo</code>) which makes Python keep all objects referenced from that cycle (including all local variables in the current frame) alive until the next cyclic garbage collection run. More detailed information can be found in the official Python documentation for <a href="https://docs.python.org/3/reference/compound_stmts.html#try" target="_blank" rel="noreferrer">the try statement</a>.</p></div></li></ul><h2 id="pytest-deprecated-call" tabindex="-1">pytest.deprecated_call <a class="header-anchor" href="#pytest-deprecated-call" aria-label="Permalink to &quot;pytest.deprecated_call {#pytest-deprecated-call}&quot;">​</a></h2><p><em>Tutorial</em>: <a href="/python/pytest/how_to_guides/warning#ensuring-code-triggers-a-deprecation-warning">Ensuring code triggers a deprecation warning</a></p><ul><li><p><code>with</code> <strong>deprecated_call</strong>(<code>*, match: Optional[Union[str, Pattern[str]]] = ...</code>) → <code>WarningsRecorder</code></p></li><li><p><code>with</code> <strong>deprecated_call</strong>(<code>func: Callable[[...], T], *args: Any, **kwargs: Any</code>) → <code>T</code></p><p>Assert that code produces a <code>DeprecationWarning</code> or <code>PendingDeprecationWarning</code>.</p><p>This function can be used as a context manager:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">warnings</span></span>
<span class="line"><span style="color:#FFCB6B;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api_call_v2</span><span style="color:#89DDFF;">()</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">warnings.warn(</span><span style="color:#FFCB6B;">&#39;use v3 of this api&#39;</span><span style="color:#FFCB6B;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DeprecationWarning</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest</span></span>
<span class="line"><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.deprecated_call</span><span style="color:#89DDFF;">()</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">assert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api_call_v2</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span></span></code></pre></div><p>It can also be used by passing a function and <code>*args</code> and <code>**kwargs</code>, in which case it will ensure calling <code>func(*args, **kwargs)</code> produces one of the warnings types above. The return value is the return value of the function.</p><p>In the context manager form you may use the keyword argument <code>match</code> to assert that the warning matches a text or regex.</p><p>The context manager produces a list of <code>warnings.WarningMessage</code> objects, one for each warning raised.</p></li></ul><h2 id="pytest-register-assert-rewrite" tabindex="-1">pytest.register_assert_rewrite <a class="header-anchor" href="#pytest-register-assert-rewrite" aria-label="Permalink to &quot;pytest.register_assert_rewrite {#pytest-register-assert-rewrite}&quot;">​</a></h2><p><em>Tutorial</em>: <a href="/python/pytest/how_to_guides/write_plugin#assertion-rewriting">Assertion Rewriting</a></p><ul><li><p><strong>register_assert_rewrite</strong>(<code>*names</code>)</p><p>Register one or more module names to be rewritten on import.</p><p>This function will make sure that this module or all modules inside the package will get their assert statements rewritten. Thus you should make sure to call this before the module is actually imported, usually in your <code>__init__.py</code> if you are a plugin using a package.</p><p><em>Parameters</em>:</p><ul><li><code>names (str)</code> – The module names to register.</li></ul></li></ul><h2 id="pytest-warns" tabindex="-1">pytest.warns <a class="header-anchor" href="#pytest-warns" aria-label="Permalink to &quot;pytest.warns {#pytest-warns}&quot;">​</a></h2><p><em>Tutorial</em>: <a href="/python/pytest/how_to_guides/warning#asserting-warnings-with-the-warns-function">Asserting warnings with the warns function</a></p><ul><li><p><code>with</code> <strong>warns</strong>(<code>expected_warning: ~typing.Union[~typing.Type[Warning], ~typing.Tuple[~typing.Type[Warning], ...]] = &lt;class Warning&gt;, *, match: ~typing.Optional[~typing.Union[str, ~typing.Pattern[str]]] = None</code>) → <code>WarningsChecker</code></p></li><li><p><code>with</code> <strong>warns</strong>(<code>expected_warning: Union[Type[Warning], Tuple[Type[Warning], ...]], func: Callable[[...], T], *args: Any, **kwargs: Any</code>) → <code>T</code></p><p>Assert that code raises a particular class of warning.</p><p>Specifically, the parameter <code>expected_warning</code> can be a warning class or sequence of warning classes, and the code inside the <code>with</code> block must issue at least one warning of that class or classes.</p><p>This helper produces a list of <code>warnings.WarningMessage</code> objects, one for each warning emitted (regardless of whether it is an <code>expected_warning</code> or not). Since pytest 8.0, unmatched warnings are also re-emitted when the context closes.</p><p>This function can be used as a context manager:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest</span></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.warns</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">RuntimeWarning</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#FFCB6B;">···</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">warnings.warn</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">&quot;my warning&quot;</span><span style="color:#FFCB6B;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RuntimeWarning</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>In the context manager form you may use the keyword argument <code>match</code> to assert that the warning matches a text or regex:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.warns</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UserWarning,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">match=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">must be 0 or None</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">warnings.warn(</span><span style="color:#FFCB6B;">&quot;value must be 0 or None&quot;</span><span style="color:#FFCB6B;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">UserWarning</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.warns</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UserWarning,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">match=r</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">must be \\d+$</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">warnings.warn(</span><span style="color:#FFCB6B;">&quot;value must be 42&quot;</span><span style="color:#FFCB6B;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">UserWarning</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">&gt;&gt;&gt; </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.warns</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UserWarning</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># catch re-emitted warning</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pytest.warns</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UserWarning,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">match=r</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">must be \\d+$</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">warnings.warn(</span><span style="color:#FFCB6B;">&quot;this is not here&quot;</span><span style="color:#FFCB6B;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">UserWarning</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">Traceback</span><span style="color:#A6ACCD;"> (most </span><span style="color:#C3E88D;">recent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">call</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">last</span><span style="color:#A6ACCD;">):</span></span>
<span class="line"><span style="color:#FFCB6B;">Failed:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DID</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WARN.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">No</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">warnings</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">...UserWarning...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">were</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">emitted...</span></span>
<span class="line"><span style="color:#82AAFF;">...</span></span></code></pre></div><p>Using with <code>pytest.mark.parametrize</code></p><p>When using <code>pytest.mark.parametrize</code> it is possible to parametrize tests such that some runs raise a warning and others do not.</p><p>This could be achieved in the same way as with exceptions, see <a href="/python/pytest/further_topics/example_trick/parametrize#parametrizing-conditional-raising">Parametrizing conditional raising</a> for an example.</p></li></ul><h2 id="pytest-freeze-includes" tabindex="-1">pytest.freeze_includes <a class="header-anchor" href="#pytest-freeze-includes" aria-label="Permalink to &quot;pytest.freeze_includes {#pytest-freeze-includes}&quot;">​</a></h2><p><em>Tutorial</em>: <a href="/python/pytest/further_topics/example_trick/basic_pattern#freezing-pytest">Freezing pytest</a></p><ul><li><p><strong>freeze_includes</strong>()</p><p>Return a list of module names used by pytest that should be included by <code>cx_freeze</code>.</p></li></ul>`,33),t=[l];function p(r,c,i,y,C,d){return e(),a("div",null,t)}const F=s(o,[["render",p]]);export{u as __pageData,F as default};
