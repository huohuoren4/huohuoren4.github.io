import{_ as s,o as e,c as a,Q as n}from"./chunks/framework.01af844e.js";const F=JSON.parse('{"title":"Installing kubeadm","description":"","frontmatter":{},"headers":[],"relativePath":"golang/k8s/get_started/prod_env/install/bootstrap/install_kubeadm.md","filePath":"golang/k8s/get_started/prod_env/install/bootstrap/install_kubeadm.md","lastUpdated":1694020305000}'),o={name:"golang/k8s/get_started/prod_env/install/bootstrap/install_kubeadm.md"},l=n(`<h1 id="installing-kubeadm" tabindex="-1">Installing kubeadm <a class="header-anchor" href="#installing-kubeadm" aria-label="Permalink to &quot;Installing kubeadm&quot;">​</a></h1><p>This page shows how to install the kubeadm toolbox. For information on how to create a cluster with kubeadm once you have performed this installation process, see the <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" target="_blank" rel="noreferrer">Creating a cluster with kubeadm</a> page.</p><h2 id="before-you-begin" tabindex="-1">Before you begin <a class="header-anchor" href="#before-you-begin" aria-label="Permalink to &quot;Before you begin&quot;">​</a></h2><ul><li><p>A compatible Linux host. The Kubernetes project provides generic instructions for Linux distributions based on Debian and Red Hat, and those distributions without a package manager.</p></li><li><p>2 GB or more of RAM per machine (any less will leave little room for your apps).</p></li><li><p>2 CPUs or more.</p></li><li><p>Full network connectivity between all machines in the cluster (public or private network is fine).</p></li><li><p>Unique hostname, MAC address, and product_uuid for every node. See <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address" target="_blank" rel="noreferrer">here</a> for more details.</p></li><li><p>Certain ports are open on your machines. See <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports" target="_blank" rel="noreferrer">here</a> for more details.</p></li><li><p>Swap disabled. You MUST disable swap in order for the kubelet to work properly.</p><ul><li>For example, <code>sudo swapoff -a</code> will disable swapping temporarily. To make this change persistent across reboots, make sure swap is disabled in config files like <code>/etc/fstab</code>, <code>systemd.swap</code>, depending how it was configured on your system.</li></ul></li></ul><h2 id="verify-the-mac-address-and-product-uuid-are-unique-for-every-node" tabindex="-1">Verify the MAC address and product_uuid are unique for every node <a class="header-anchor" href="#verify-the-mac-address-and-product-uuid-are-unique-for-every-node" aria-label="Permalink to &quot;Verify the MAC address and product_uuid are unique for every node&quot;">​</a></h2><ul><li>You can get the MAC address of the network interfaces using the command <code>ip link</code> or <code>ifconfig -a</code></li><li>The product_uuid can be checked by using the command <code>sudo cat /sys/class/dmi/id/product_uuid</code></li></ul><p>It is very likely that hardware devices will have unique addresses, although some virtual machines may have identical values. Kubernetes uses these values to uniquely identify the nodes in the cluster. If these values are not unique to each node, the installation process may <a href="https://github.com/kubernetes/kubeadm/issues/31" target="_blank" rel="noreferrer">fail</a>.</p><h2 id="check-network-adapters" tabindex="-1">Check network adapters <a class="header-anchor" href="#check-network-adapters" aria-label="Permalink to &quot;Check network adapters&quot;">​</a></h2><p>If you have more than one network adapter, and your Kubernetes components are not reachable on the default route, we recommend you add IP route(s) so Kubernetes cluster addresses go via the appropriate adapter.</p><h2 id="check-required-ports" tabindex="-1">Check required ports <a class="header-anchor" href="#check-required-ports" aria-label="Permalink to &quot;Check required ports&quot;">​</a></h2><p>These <a href="https://kubernetes.io/docs/reference/networking/ports-and-protocols/" target="_blank" rel="noreferrer">required ports</a> need to be open in order for Kubernetes components to communicate with each other. You can use tools like netcat to check if a port is open. For example:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">nc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6443</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">nc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6443</span></span></code></pre></div><p>The pod network plugin you use may also require certain ports to be open. Since this differs with each pod network plugin, please see the documentation for the plugins about what port(s) those need.</p><h2 id="installing-a-container-runtime" tabindex="-1">Installing a container runtime <a class="header-anchor" href="#installing-a-container-runtime" aria-label="Permalink to &quot;Installing a container runtime&quot;">​</a></h2><p>To run containers in Pods, Kubernetes uses a container runtime.</p><p>By default, Kubernetes uses the Container Runtime Interface (CRI) to interface with your chosen container runtime.</p><p>If you don&#39;t specify a runtime, kubeadm automatically tries to detect an installed container runtime by scanning through a list of known endpoints.</p><p>If multiple or no container runtimes are detected kubeadm will throw an error and will request that you specify which one you want to use.</p><p>See <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/" target="_blank" rel="noreferrer">container runtimes</a> for more information.</p><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>Docker Engine does not implement the <a href="https://kubernetes.io/docs/concepts/architecture/cri/" target="_blank" rel="noreferrer">CRI</a> which is a requirement for a container runtime to work with Kubernetes. For that reason, an additional service <a href="https://github.com/Mirantis/cri-dockerd" target="_blank" rel="noreferrer">cri-dockerd</a> has to be installed. cri-dockerd is a project based on the legacy built-in Docker Engine support that was <a href="https://kubernetes.io/dockershim" target="_blank" rel="noreferrer">removed</a> from the kubelet in version 1.24.</p></div><p>The tables below include the known endpoints for supported operating systems:</p><ul><li><strong>Linux</strong></li></ul><table><thead><tr><th style="text-align:left;">Runtime</th><th style="text-align:left;">Path to Unix domain socket</th></tr></thead><tbody><tr><td style="text-align:left;">containerd</td><td style="text-align:left;"><code>unix:///var/run/containerd/containerd.sock</code></td></tr><tr><td style="text-align:left;">CRI-O</td><td style="text-align:left;"><code>unix:///var/run/crio/crio.sock</code></td></tr><tr><td style="text-align:left;">Docker Engine (using cri-dockerd)</td><td style="text-align:left;"><code>unix:///var/run/cri-dockerd.sock</code></td></tr><tr><td style="text-align:left;">containerd</td><td style="text-align:left;"><code>unix:///var/run/containerd/containerd.sock</code></td></tr></tbody></table><ul><li><strong>Windows</strong></li></ul><table><thead><tr><th>Runtime</th><th>Path to Windows named pipe</th></tr></thead><tbody><tr><td>containerd</td><td>npipe:////./pipe/containerd-containerd</td></tr><tr><td>Docker Engine (using cri-dockerd)</td><td>npipe:////./pipe/cri-dockerd</td></tr></tbody></table><h2 id="installing-kubeadm-kubelet-and-kubectl" tabindex="-1">Installing kubeadm, kubelet and kubectl <a class="header-anchor" href="#installing-kubeadm-kubelet-and-kubectl" aria-label="Permalink to &quot;Installing kubeadm, kubelet and kubectl&quot;">​</a></h2><p>You will install these packages on all of your machines:</p><ul><li><p><code>kubeadm</code>: the command to bootstrap the cluster.</p></li><li><p><code>kubelet</code>: the component that runs on all of the machines in your cluster and does things like starting pods and containers.</p></li><li><p><code>kubectl</code>: the command line util to talk to your cluster.</p></li></ul><p>kubeadm will not install or manage <code>kubelet</code> or <code>kubectl</code> for you, so you will need to ensure they match the version of the Kubernetes control plane you want kubeadm to install for you. If you do not, there is a risk of a version skew occurring that can lead to unexpected, buggy behaviour. However, one minor version skew between the kubelet and the control plane is supported, but the kubelet version may never exceed the API server version. For example, the kubelet running 1.7.0 should be fully compatible with a 1.8.0 API server, but not vice versa.</p><p>For information about installing <code>kubectl</code>, see <a href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noreferrer">Install and set up kubectl</a>.</p><div class="warning custom-block"><p class="custom-block-title">Warning:</p><p>These instructions exclude all Kubernetes packages from any system upgrades. This is because kubeadm and Kubernetes require <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/" target="_blank" rel="noreferrer">special attention to upgrade</a>.</p></div><p>For more information on version skews, see:</p><ul><li>Kubernetes <a href="https://kubernetes.io/docs/setup/release/version-skew-policy/" target="_blank" rel="noreferrer">version and version-skew policy</a></li><li>Kubeadm-specific <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#version-skew-policy" target="_blank" rel="noreferrer">version skew policy</a></li></ul><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>Kubernetes has two different package repositories starting from August 2023. The Google-hosted repository is deprecated and it&#39;s being replaced with the Kubernetes (community-owned) package repositories. The Kubernetes project strongly recommends using the Kubernetes community-owned package repositories, because the project plans to stop publishing packages to the Google-hosted repository in the future.</p><p>There are some important considerations for the Kubernetes package repositories:</p><ul><li><p>The Kubernetes package repositories contain packages beginning with those Kubernetes versions that were still under support when the community took over the package builds. This means that anything before v1.24.0 will only be available in the Google-hosted repository.</p></li><li><p>There&#39;s a dedicated package repository for each Kubernetes minor version. When upgrading to a different minor release, you must bear in mind that the package repository details also change.</p></li></ul></div><h4 id="debian-based-distributions" tabindex="-1">Debian-based distributions <a class="header-anchor" href="#debian-based-distributions" aria-label="Permalink to &quot;Debian-based distributions&quot;">​</a></h4><p><em>Kubernetes package repositories</em></p><p>These instructions are for Kubernetes 1.28.</p><ol><li>Update the <code>apt</code> package index and install packages needed to use the Kubernetes <code>apt</code> repository:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"><span style="color:#6A737D;"># apt-transport-https may be a dummy package; if so, you can skip that package</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-transport-https</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca-certificates</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span>
<span class="line"><span style="color:#6A737D;"># apt-transport-https may be a dummy package; if so, you can skip that package</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-transport-https</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca-certificates</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span></span></code></pre></div><ol start="2"><li>Download the public signing key for the Kubernetes package repositories. The same signing key is used for all repositories so you can disregard the version in the URL:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-fsSL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gpg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dearmor</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/apt/keyrings/kubernetes-apt-keyring.gpg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-fsSL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gpg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dearmor</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/apt/keyrings/kubernetes-apt-keyring.gpg</span></span></code></pre></div><ol start="3"><li>Add the appropriate Kubernetes <code>apt</code> repository:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/apt/sources.list.d/kubernetes.list</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/apt/sources.list.d/kubernetes.list</span></span></code></pre></div><ol start="4"><li>Update the <code>apt</code> package index, install kubelet, kubeadm and kubectl, and pin their version:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-mark</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hold</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-mark</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hold</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>In releases older than Debian 12 and Ubuntu 22.04, <code>/etc/apt/keyrings</code> does not exist by default; you can create it by running <code>sudo mkdir -m 755 /etc/apt/keyrings</code></p></div><p><em>Google-hosted package repository (deprecated)</em></p><p>These instructions are for Kubernetes 1.28.</p><ol><li>Update the <code>apt</code> package index and install packages needed to use the Kubernetes <code>apt</code> repository:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"><span style="color:#6A737D;"># apt-transport-https may be a dummy package; if so, you can skip that package</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-transport-https</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca-certificates</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span>
<span class="line"><span style="color:#6A737D;"># apt-transport-https may be a dummy package; if so, you can skip that package</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-transport-https</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca-certificates</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span></span></code></pre></div><ol start="2"><li>Download the Google Cloud public signing key:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-fsSL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://dl.k8s.io/apt/doc/apt-key.gpg</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gpg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dearmor</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/apt/keyrings/kubernetes-archive-keyring.gpg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-fsSL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://dl.k8s.io/apt/doc/apt-key.gpg</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gpg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dearmor</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/apt/keyrings/kubernetes-archive-keyring.gpg</span></span></code></pre></div><ol start="3"><li>Add the Google-hosted <code>apt</code> repository:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/apt/sources.list.d/kubernetes.list</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/apt/sources.list.d/kubernetes.list</span></span></code></pre></div><ol start="3"><li>Update the <code>apt</code> package index, install kubelet, kubeadm and kubectl, and pin their version:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apt-mark</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hold</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apt-mark</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hold</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>In releases older than Debian 12 and Ubuntu 22.04, <code>/etc/apt/keyrings</code> does not exist by default; you can create it by running <code>sudo mkdir -m 755 /etc/apt/keyrings</code></p></div><h4 id="red-hat-based-distributions" tabindex="-1">Red Hat-based distributions <a class="header-anchor" href="#red-hat-based-distributions" aria-label="Permalink to &quot;Red Hat-based distributions&quot;">​</a></h4><ol><li>Set SELinux to <code>permissive</code> mode:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Set SELinux in permissive mode (effectively disabling it)</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setenforce</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/selinux/config</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Set SELinux in permissive mode (effectively disabling it)</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setenforce</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/selinux/config</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Caution:</p><ul><li><p>Setting SELinux in permissive mode by running <code>setenforce 0</code> and <code>sed ...</code> effectively disables it. This is required to allow containers to access the host filesystem; for example, some cluster network plugins require that. You have to do this until SELinux support is improved in the kubelet.</p></li><li><p>You can leave SELinux enabled if you know how to configure it but it may require settings that are not supported by kubeadm.</p></li></ul></div><p><em>Kubernetes package repositories</em></p><p>These instructions are for Kubernetes 1.28.</p><ol start="2"><li>Add the Kubernetes <code>yum</code> repository. The <code>exclude</code> parameter in the repository definition ensures that the packages related to Kubernetes are not upgraded upon running <code>yum update</code> as there&#39;s a special procedure that must be followed for upgrading Kubernetes.</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> sudo tee /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#9ECBFF;">[kubernetes]</span></span>
<span class="line"><span style="color:#9ECBFF;">name=Kubernetes</span></span>
<span class="line"><span style="color:#9ECBFF;">baseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/</span></span>
<span class="line"><span style="color:#9ECBFF;">enabled=1</span></span>
<span class="line"><span style="color:#9ECBFF;">gpgcheck=1</span></span>
<span class="line"><span style="color:#9ECBFF;">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key</span></span>
<span class="line"><span style="color:#9ECBFF;">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> sudo tee /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#032F62;">[kubernetes]</span></span>
<span class="line"><span style="color:#032F62;">name=Kubernetes</span></span>
<span class="line"><span style="color:#032F62;">baseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/</span></span>
<span class="line"><span style="color:#032F62;">enabled=1</span></span>
<span class="line"><span style="color:#032F62;">gpgcheck=1</span></span>
<span class="line"><span style="color:#032F62;">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key</span></span>
<span class="line"><span style="color:#032F62;">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ol start="3"><li>Install kubelet, kubeadm and kubectl, and enable kubelet to ensure it&#39;s automatically started on startup:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--disableexcludes=kubernetes</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--disableexcludes=kubernetes</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span></code></pre></div><p><em>Google-hosted package repository (deprecated)</em></p><p>These instructions are for Kubernetes 1.28.</p><ol start="2"><li>Add the Google-hosted <code>yum</code> repository. The <code>exclude</code> parameter in the repository definition ensures that the packages related to Kubernetes are not upgraded upon running <code>yum update</code> as there&#39;s a special procedure that must be followed for upgrading Kubernetes.</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> sudo tee /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#9ECBFF;">[kubernetes]</span></span>
<span class="line"><span style="color:#9ECBFF;">name=Kubernetes</span></span>
<span class="line"><span style="color:#9ECBFF;">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">basearch</span></span>
<span class="line"><span style="color:#9ECBFF;">enabled=1</span></span>
<span class="line"><span style="color:#9ECBFF;">gpgcheck=1</span></span>
<span class="line"><span style="color:#9ECBFF;">gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="color:#9ECBFF;">exclude=kubelet kubeadm kubectl</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># This overwrites any existing configuration in /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> sudo tee /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span style="color:#032F62;">[kubernetes]</span></span>
<span class="line"><span style="color:#032F62;">name=Kubernetes</span></span>
<span class="line"><span style="color:#032F62;">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">basearch</span></span>
<span class="line"><span style="color:#032F62;">enabled=1</span></span>
<span class="line"><span style="color:#032F62;">gpgcheck=1</span></span>
<span class="line"><span style="color:#032F62;">gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="color:#032F62;">exclude=kubelet kubeadm kubectl</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ol start="3"><li>Install kubelet, kubeadm and kubectl, and enable kubelet to ensure it&#39;s automatically started on startup:</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--disableexcludes=kubernetes</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--disableexcludes=kubernetes</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>If the baseurl fails because your RPM-based distribution cannot interpret <code>$basearch</code>, replace <code>\\$basearch</code> with your computer&#39;s architecture. Type <code>uname -m</code> to see that value. For example, the <code>baseurl</code> URL for <code>x86_64</code> could be: <code>https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</code>.</p></div><h4 id="without-a-package-manager" tabindex="-1">Without a package manager <a class="header-anchor" href="#without-a-package-manager" aria-label="Permalink to &quot;Without a package manager&quot;">​</a></h4><p>Install CNI plugins (required for most pod network):</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">CNI_PLUGINS_VERSION</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;v1.3.0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ARCH</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;amd64&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">DEST</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;/opt/cni/bin&quot;</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DEST</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://github.com/containernetworking/plugins/releases/download/\${</span><span style="color:#E1E4E8;">CNI_PLUGINS_VERSION</span><span style="color:#9ECBFF;">}/cni-plugins-linux-\${</span><span style="color:#E1E4E8;">ARCH</span><span style="color:#9ECBFF;">}-\${</span><span style="color:#E1E4E8;">CNI_PLUGINS_VERSION</span><span style="color:#9ECBFF;">}.tgz&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DEST</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-xz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">CNI_PLUGINS_VERSION</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;v1.3.0&quot;</span></span>
<span class="line"><span style="color:#24292E;">ARCH</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;amd64&quot;</span></span>
<span class="line"><span style="color:#24292E;">DEST</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;/opt/cni/bin&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DEST</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://github.com/containernetworking/plugins/releases/download/\${</span><span style="color:#24292E;">CNI_PLUGINS_VERSION</span><span style="color:#032F62;">}/cni-plugins-linux-\${</span><span style="color:#24292E;">ARCH</span><span style="color:#032F62;">}-\${</span><span style="color:#24292E;">CNI_PLUGINS_VERSION</span><span style="color:#032F62;">}.tgz&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DEST</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-xz</span></span></code></pre></div><p>Define the directory to download command files</p><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>The <code>DOWNLOAD_DIR</code> variable must be set to a writable directory. If you are running Flatcar Container Linux, <code>set DOWNLOAD_DIR=&quot;/opt/bin&quot;</code>.</p></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">DOWNLOAD_DIR</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;/usr/local/bin&quot;</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DOWNLOAD_DIR</span><span style="color:#9ECBFF;">&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">DOWNLOAD_DIR</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;/usr/local/bin&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DOWNLOAD_DIR</span><span style="color:#032F62;">&quot;</span></span></code></pre></div><p>Install crictl (required for kubeadm / Kubelet Container Runtime Interface (CRI))</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">CRICTL_VERSION</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;v1.28.0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ARCH</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;amd64&quot;</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://github.com/kubernetes-sigs/cri-tools/releases/download/\${</span><span style="color:#E1E4E8;">CRICTL_VERSION</span><span style="color:#9ECBFF;">}/crictl-\${</span><span style="color:#E1E4E8;">CRICTL_VERSION</span><span style="color:#9ECBFF;">}-linux-\${</span><span style="color:#E1E4E8;">ARCH</span><span style="color:#9ECBFF;">}.tar.gz&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> $DOWNLOAD_DIR </span><span style="color:#79B8FF;">-xz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">CRICTL_VERSION</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;v1.28.0&quot;</span></span>
<span class="line"><span style="color:#24292E;">ARCH</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;amd64&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://github.com/kubernetes-sigs/cri-tools/releases/download/\${</span><span style="color:#24292E;">CRICTL_VERSION</span><span style="color:#032F62;">}/crictl-\${</span><span style="color:#24292E;">CRICTL_VERSION</span><span style="color:#032F62;">}-linux-\${</span><span style="color:#24292E;">ARCH</span><span style="color:#032F62;">}.tar.gz&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> $DOWNLOAD_DIR </span><span style="color:#005CC5;">-xz</span></span></code></pre></div><p>Install <code>kubeadm</code>, <code>kubelet</code>, <code>kubectl</code> and add a <code>kubelet</code> systemd service:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">RELEASE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;$(</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-sSL</span><span style="color:#9ECBFF;"> https://dl.k8s.io/release/stable.txt)&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ARCH</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;amd64&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> $DOWNLOAD_DIR</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--remote-name-all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://dl.k8s.io/release/</span><span style="color:#E1E4E8;">\${RELEASE}</span><span style="color:#9ECBFF;">/bin/linux/</span><span style="color:#E1E4E8;">\${ARCH}</span><span style="color:#9ECBFF;">/{kubeadm,kubelet}</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{kubeadm,kubelet}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">RELEASE_VERSION</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;v0.15.1&quot;</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sSL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://raw.githubusercontent.com/kubernetes/release/\${</span><span style="color:#E1E4E8;">RELEASE_VERSION</span><span style="color:#9ECBFF;">}/cmd/kubepkg/templates/latest/deb/kubelet/lib/systemd/system/kubelet.service&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;s:/usr/bin:\${</span><span style="color:#E1E4E8;">DOWNLOAD_DIR</span><span style="color:#9ECBFF;">}:g&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/systemd/system/kubelet.service</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/systemd/system/kubelet.service.d</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sSL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://raw.githubusercontent.com/kubernetes/release/\${</span><span style="color:#E1E4E8;">RELEASE_VERSION</span><span style="color:#9ECBFF;">}/cmd/kubepkg/templates/latest/deb/kubeadm/10-kubeadm.conf&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;s:/usr/bin:\${</span><span style="color:#E1E4E8;">DOWNLOAD_DIR</span><span style="color:#9ECBFF;">}:g&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tee</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">RELEASE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;$(</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-sSL</span><span style="color:#032F62;"> https://dl.k8s.io/release/stable.txt)&quot;</span></span>
<span class="line"><span style="color:#24292E;">ARCH</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;amd64&quot;</span></span>
<span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> $DOWNLOAD_DIR</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--remote-name-all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://dl.k8s.io/release/</span><span style="color:#24292E;">\${RELEASE}</span><span style="color:#032F62;">/bin/linux/</span><span style="color:#24292E;">\${ARCH}</span><span style="color:#032F62;">/{kubeadm,kubelet}</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chmod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{kubeadm,kubelet}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">RELEASE_VERSION</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;v0.15.1&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sSL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://raw.githubusercontent.com/kubernetes/release/\${</span><span style="color:#24292E;">RELEASE_VERSION</span><span style="color:#032F62;">}/cmd/kubepkg/templates/latest/deb/kubelet/lib/systemd/system/kubelet.service&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;s:/usr/bin:\${</span><span style="color:#24292E;">DOWNLOAD_DIR</span><span style="color:#032F62;">}:g&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/systemd/system/kubelet.service</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/systemd/system/kubelet.service.d</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sSL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://raw.githubusercontent.com/kubernetes/release/\${</span><span style="color:#24292E;">RELEASE_VERSION</span><span style="color:#032F62;">}/cmd/kubepkg/templates/latest/deb/kubeadm/10-kubeadm.conf&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;s:/usr/bin:\${</span><span style="color:#24292E;">DOWNLOAD_DIR</span><span style="color:#032F62;">}:g&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tee</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span></code></pre></div><p>Install kubectl by following the instructions on <a href="https://kubernetes.io/docs/tasks/tools/#kubectl" target="_blank" rel="noreferrer">Install Tools page</a>.</p><p>Enable and start <code>kubelet</code>:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>The Flatcar Container Linux distribution mounts the <code>/usr</code> directory as a read-only filesystem. Before bootstrapping your cluster, you need to take additional steps to configure a writable directory. See the <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/#usr-mounted-read-only/" target="_blank" rel="noreferrer">Kubeadm Troubleshooting guide</a> to learn how to set up a writable directory.</p></div><p>The kubelet is now restarting every few seconds, as it waits in a crashloop for kubeadm to tell it what to do.</p><h2 id="configuring-a-cgroup-driver" tabindex="-1">Configuring a cgroup driver <a class="header-anchor" href="#configuring-a-cgroup-driver" aria-label="Permalink to &quot;Configuring a cgroup driver&quot;">​</a></h2><p>Both the container runtime and the kubelet have a property called <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/" target="_blank" rel="noreferrer">&quot;cgroup driver&quot;</a>, which is important for the management of cgroups on Linux machines.</p><div class="warning custom-block"><p class="custom-block-title">Warning:</p><p>Matching the container runtime and kubelet cgroup drivers is required or otherwise the kubelet process will fail.</p><p>See <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/" target="_blank" rel="noreferrer">Configuring a cgroup driver</a> for more details.</p></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><p>If you are running into difficulties with kubeadm, please consult our <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/" target="_blank" rel="noreferrer">troubleshooting docs</a>.</p><h2 id="what-s-next" tabindex="-1">What&#39;s next <a class="header-anchor" href="#what-s-next" aria-label="Permalink to &quot;What&#39;s next&quot;">​</a></h2><ul><li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" target="_blank" rel="noreferrer">Using kubeadm to Create a Cluster</a></li></ul>`,96),p=[l];function t(r,c,i,y,d,u){return e(),a("div",null,p)}const h=s(o,[["render",t]]);export{F as __pageData,h as default};
