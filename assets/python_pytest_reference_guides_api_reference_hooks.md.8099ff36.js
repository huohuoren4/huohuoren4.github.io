import{_ as e,o as t,c as o,V as r}from"./chunks/framework.48c56699.js";const m=JSON.parse('{"title":"Hooks","description":"","frontmatter":{},"headers":[],"relativePath":"python/pytest/reference_guides/api_reference/hooks.md","filePath":"python/pytest/reference_guides/api_reference/hooks.md","lastUpdated":1690824429000}'),i={name:"python/pytest/reference_guides/api_reference/hooks.md"},s=r(`<h1 id="hooks" tabindex="-1">Hooks <a class="header-anchor" href="#hooks" aria-label="Permalink to &quot;Hooks&quot;">​</a></h1><p><em>Tutorial</em>: <a href="https://docs.pytest.org/en/latest/how-to/writing_plugins.html#writing-plugins" target="_blank" rel="noreferrer">Writing plugins</a></p><p>Reference to all hooks which can be implemented by <a href="https://docs.pytest.org/en/latest/how-to/writing_plugins.html#localplugin" target="_blank" rel="noreferrer">conftest.py files</a> and <a href="https://docs.pytest.org/en/latest/how-to/writing_plugins.html#plugins" target="_blank" rel="noreferrer">plugins</a>.</p><h2 id="bootstrapping-hooks" tabindex="-1">Bootstrapping hooks <a class="header-anchor" href="#bootstrapping-hooks" aria-label="Permalink to &quot;Bootstrapping hooks&quot;">​</a></h2><p>Bootstrapping hooks called for plugins registered early enough (internal and setuptools plugins).</p><ul><li><p><strong>pytest_load_initial_conftests</strong>(<code>early_config, parser, args</code>)</p><p>Called to implement the loading of initial conftest files ahead of command line option parsing.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook will not be called for <code>conftest.py</code> files, only for setuptools plugins.</p></div><p><em>Parameters</em>:</p><ul><li><p><code>early_config (Config)</code> – The pytest config object.</p></li><li><p><code>args (List[str])</code> – Arguments passed on the command line.</p></li><li><p><code>parser (Parser)</code> – To add command line options.</p></li></ul></li><li><p><strong>pytest_cmdline_preparse</strong>(<code>config, args</code>)</p><p><em>(Deprecated)</em> modify command line arguments before option parsing.</p><p>This hook is considered deprecated and will be removed in a future pytest version. Consider using <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_load_initial_conftests" target="_blank" rel="noreferrer">pytest_load_initial_conftests</a> instead.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook will not be called for <code>conftest.py</code> files, only for setuptools plugins.</p></div><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest config object.</p></li><li><p><code>args (List[str])</code> – Arguments passed on the command line.</p></li></ul></li><li><p><strong>pytest_cmdline_parse</strong>(<code>pluginmanager, args</code>)</p><p>Return an initialized <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Config" target="_blank" rel="noreferrer">Config</a>, parsing the specified args.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook will only be called for plugin classes passed to the <code>plugins</code> arg when using pytest.main to perform an in-process test run.</p></div><p><em>Parameters</em>:</p><ul><li><p><code>pluginmanager (PytestPluginManager)</code> – The pytest plugin manager.</p></li><li><p><code>args (List[str])</code> – List of arguments passed on the command line.</p></li></ul><p><em>Returns</em>: A pytest config object.</p><p><em>Return type</em>: <code>Optional[Config]</code></p></li><li><p><strong>pytest_cmdline_main</strong>(<code>config</code>)</p><p>Called for performing the main command line action. The default implementation will invoke the configure hooks and runtest_mainloop.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p><em>Parameters</em>:</p><ul><li><code>config (Config)</code> – The pytest config object.</li></ul><p><em>Returns</em>: The exit code.</p><p><em>Return type</em>: <code>Optional[Union[ExitCode, int]]</code></p></li></ul><h2 id="initialization-hooks" tabindex="-1">Initialization hooks <a class="header-anchor" href="#initialization-hooks" aria-label="Permalink to &quot;Initialization hooks&quot;">​</a></h2><p>Initialization hooks called for plugins and <code>conftest.py</code> files.</p><ul><li><p><strong>pytest_addoption</strong>(<code>parser, pluginmanager</code>)</p><p>Register argparse-style options and ini-style config values, called once at the beginning of a test run.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This function should be implemented only in plugins or <code>conftest.py</code> files situated at the tests root directory due to how pytest <a href="https://docs.pytest.org/en/latest/how-to/writing_plugins.html#pluginorder" target="_blank" rel="noreferrer">discovers plugins during startup</a>.</p></div><p><em>Parameters</em>:</p><ul><li><p><code>parser (pytest.Parser)</code> – To add command line options, call <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Parser.addoption" target="_blank" rel="noreferrer">parser.addoption(...)</a>. To add ini-file values call <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Parser.addini" target="_blank" rel="noreferrer">parser.addini(...)</a>.</p></li><li><p><code>pluginmanager (pytest.PytestPluginManager)</code> – The pytest plugin manager, which can be used to install <code>hookspec()</code>’s or <code>hookimpl()</code>’s and allow one plugin to call another plugin’s hooks to change how command line options are added.</p></li></ul><p>Options can later be accessed through the <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Config" target="_blank" rel="noreferrer">config</a> object, respectively:</p><ul><li><p><code>config.getoption(name)</code> to retrieve the value of a command line option.</p></li><li><p><code>config.getini(name)</code> to retrieve a value read from an ini-style file.</p></li></ul><p>The config object is passed around on many internal objects via the <code>.config</code> attribute or can be retrieved as the <code>pytestconfig</code> fixture.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook is incompatible with hook wrappers.</p></div></li><li><p><strong>pytest_addhooks</strong>(<code>pluginmanager</code>)</p><p>Called at plugin registration time to allow adding new hooks via a call to <code>pluginmanager.add_hookspecs(module_or_class, prefix)</code>.</p><p><em>Parameters</em>:</p><ul><li><code>pluginmanager (pytest.PytestPluginManager)</code> – The pytest plugin manager.</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook is incompatible with hook wrappers.</p></div></li><li><p><strong>pytest_configure</strong>(<code>config</code>)</p><p>Allow plugins and conftest files to perform initial configuration.</p><p>This hook is called for every plugin and initial conftest file after command line options have been parsed.</p><p>After that, the hook is called for other conftest files as they are imported.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook is incompatible with hook wrappers.</p></div><p><em>Parameters</em>:</p><ul><li><code>config (pytest.Config)</code> – The pytest config object.</li></ul></li><li><p><strong>pytest_unconfigure</strong>(<code>config</code>)</p><p>Called before test process is exited.</p><p><em>Parameters</em>:</p><ul><li><code>config (Config)</code> – The pytest config object.</li></ul></li><li><p><strong>pytest_sessionstart</strong>(<code>session</code>)</p><p>Called after the <code>Session</code> object has been created and before performing collection and entering the run test loop.</p><p><em>Parameters</em>:</p><ul><li><code>session (Session)</code> – The pytest session object.</li></ul></li><li><p><strong>pytest_sessionfinish</strong>(<code>session, exitstatus</code>)</p><p>Called after whole test run finished, right before returning the exit status to the system.</p><p><em>Parameters</em>:</p><ul><li><p><code>session (Session)</code> – The pytest session object.</p></li><li><p><code>exitstatus (Union[int, ExitCode])</code> – The status which pytest will return to the system.</p></li></ul></li><li><p><strong>pytest_plugin_registered</strong>(<code>plugin, manager</code>)</p><p>A new pytest plugin got registered.</p><p><em>Parameters</em>:</p><ul><li><p><code>plugin (_PluggyPlugin)</code> – The plugin module or instance.</p></li><li><p><code>manager (pytest.PytestPluginManager)</code> – pytest plugin manager.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This hook is incompatible with hook wrappers.</p></div></li></ul><h2 id="collection-hooks" tabindex="-1">Collection hooks <a class="header-anchor" href="#collection-hooks" aria-label="Permalink to &quot;Collection hooks&quot;">​</a></h2><p><code>pytest</code> calls the following hooks for collecting files and directories:</p><ul><li><p><strong>pytest_collection</strong>(<code>session</code>)</p><p>Perform the collection phase for the given session.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>. The return value is not used, but only stops further processing.</p><p>The default collection phase is this (see individual hooks for full details):</p><ol><li><p>Starting from <code>session</code> as the initial collector:</p><ul><li><p><code>pytest_collectstart(collector)</code></p></li><li><p><code>report = pytest_make_collect_report(collector)</code></p></li><li><p><code>pytest_exception_interact(collector, call, report)</code> if an interactive exception occurred</p></li><li><p>For each collected node:</p><ul><li><p>If an item, <code>pytest_itemcollected(item)</code></p></li><li><p>If a collector, recurse into it.</p></li></ul></li><li><p><code>pytest_collectreport(report)</code></p></li></ul></li><li><p><code>pytest_collection_modifyitems(session, config, items)</code></p><ul><li><code>pytest_deselected(items)</code> for any deselected items (may be called multiple times)</li></ul></li><li><p><code>pytest_collection_finish(session)</code></p></li><li><p>Set <code>session.items</code> to the list of collected items</p></li><li><p>Set <code>session.testscollected</code> to the number of collected items</p></li></ol><p>You can implement this hook to only perform some action before collection, for example the terminal plugin uses it to start displaying the collection counter (and returns <code>None</code>).</p><p><em>Parameters</em>:</p><ul><li><code>session (Session)</code> – The pytest session object.</li></ul></li><li><p><strong>pytest_ignore_collect</strong>(<code>collection_path, path, config</code>)</p><p>Return True to prevent considering this path for collection.</p><p>This hook is consulted for all files and directories prior to calling more specific hooks.</p><p>Stops at first non-None result, see firstresult: stop at first non-None result.</p><p><em>Parameters</em>:</p><ul><li><p><code>collection_path(Path)</code> – The path to analyze.</p></li><li><p><code>path(LEGACY_PATH)</code> – The path to analyze (deprecated).</p></li><li><p><code>config(Config)</code> – The pytest config object.</p></li></ul><p><em>Changed in version 7.0.0</em>: The <code>collection_path</code> parameter was added as a <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" target="_blank" rel="noreferrer">pathlib.Path</a> equivalent of the <code>path</code> parameter. The <code>path</code> parameter has been deprecated.</p></li><li><p><strong>pytest_collect_file</strong>(<code>file_path, path, parent</code>)</p><p>Create a <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Collector" target="_blank" rel="noreferrer">Collector</a> for the given path, or None if not relevant.</p><p>The new node needs to have the specified <code>parent</code> as a parent.</p><p><em>Parameters</em>:</p><ul><li><p><code>file_path (Path)</code> – The path to analyze.</p></li><li><p><code>path (LEGACY_PATH)</code> – The path to collect (deprecated).</p></li></ul><p><em>Changed in version 7.0.0</em>: The <code>file_path</code> parameter was added as a <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" target="_blank" rel="noreferrer">pathlib.Path</a> equivalent of the <code>path</code> parameter. The <code>path</code> parameter has been deprecated.</p></li><li><p><strong>pytest_pycollect_makemodule</strong>(<code>module_path, path, parent</code>)</p><p>Return a <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Module" target="_blank" rel="noreferrer">pytest.Module</a> collector or None for the given path.</p><p>This hook will be called for each matching test module path. The <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_collect_file" target="_blank" rel="noreferrer">pytest_collect_file</a> hook needs to be used if you want to create test modules for files that do not match as a test module.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p><em>Parameters</em>:</p><ul><li><p><code>module_path (Path)</code> – The path of the module to collect.</p></li><li><p><code>path (LEGACY_PATH)</code> – The path of the module to collect (deprecated).</p></li></ul><p><em>Changed in version 7.0.0</em>: The <code>module_path</code> parameter was added as a <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" target="_blank" rel="noreferrer">pathlib.Path</a> equivalent of the <code>path</code> parameter.</p><p>The path parameter has been deprecated in favor of <code>fspath</code>.</p></li></ul><p>For influencing the collection of objects in Python modules you can use the following hook:</p><ul><li><p><strong>pytest_pycollect_makeitem</strong>(<code>collector, name, obj</code>)</p><p>Return a custom item/collector for a Python object in a module, or None.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p><em>Parameters</em>:</p><ul><li><p><code>collector (Union[Module, Class])</code> – The module/class collector.</p></li><li><p><code>name (str)</code> – The name of the object in the module/class.</p></li><li><p><code>obj (object)</code> – The object.</p></li></ul><p><em>Returns</em>: The created items/collectors.</p><p><em>Return type</em>: <code>Union[None, Item, Collector, List[Union[Item, Collector]]]</code></p></li><li><p><strong>pytest_generate_tests</strong>(<code>metafunc</code>)</p><p>Generate (multiple) parametrized calls to a test function.</p><p><em>Parameters</em>：</p><ul><li><code>metafunc (Metafunc)</code> – The Metafunc helper for the test function.</li></ul></li><li><p><strong>pytest_make_parametrize_id</strong>(<code>config, val, argname</code>)</p><p>Return a user-friendly string representation of the given <code>val</code> that will be used by @pytest.mark.parametrize calls, or None if the hook doesn’t know about <code>val</code>.</p><p>The parameter name is available as <code>argname</code>, if required.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest config object.</p></li><li><p><code>val (object)</code> – The parametrized value.</p></li><li><p><code>argname (str)</code> – The automatic parameter name produced by pytest.</p></li></ul></li></ul><p>Hooks for influencing test skipping:</p><ul><li><p><strong>pytest_markeval_namespace</strong>(<code>config</code>)</p><p>Called when constructing the globals dictionary used for evaluating string conditions in xfail/skipif markers.</p><p>This is useful when the condition for a marker requires objects that are expensive or impossible to obtain during collection time, which is required by normal boolean conditions.</p><p><em>New in version 6.2.</em></p><p><em>Parameters</em>:</p><ul><li><code>config (Config)</code> – The pytest config object.</li></ul><p><em>Returns</em>: A dictionary of additional globals to add.</p><p><em>Return type</em>: <code>Dict[str, Any]</code></p></li></ul><p>After collection is complete, you can modify the order of items, delete or otherwise amend the test items:</p><ul><li><p><strong>pytest_collection_modifyitems</strong>(<code>session, config, items</code>)</p><p>Called after collection has been performed. May filter or re-order the items in-place.</p><p><em>Parameters</em>:</p><ul><li><p><code>session (Session)</code> – The pytest session object.</p></li><li><p><code>config (Config)</code> – The pytest config object.</p></li><li><p><code>items (List[Item])</code> – List of item objects.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If this hook is implemented in <code>conftest.py</code> files, it always receives all collected items, not only those under the <code>conftest.py</code> where it is implemented.</p></div></li><li><p><strong>pytest_collection_finish</strong>(<code>session</code>)</p><p>Called after collection has been performed and modified.</p><p><em>Parameters</em>:</p><ul><li><code>session (Session)</code> – The pytest session object.</li></ul></li></ul><h2 id="test-running-runtest-hooks" tabindex="-1">Test running (runtest) hooks <a class="header-anchor" href="#test-running-runtest-hooks" aria-label="Permalink to &quot;Test running (runtest) hooks&quot;">​</a></h2><p>All runtest related hooks receive a pytest.Item object.</p><ul><li><p><strong>pytest_runtestloop</strong>(<code>session</code>)</p><p>Perform the main runtest loop (after collection finished).</p><p>The default hook implementation performs the runtest protocol for all items collected in the session (<code>session.items</code>), unless the collection failed or the <code>collectonly</code> pytest option is set.</p><p>If at any point <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.exit" target="_blank" rel="noreferrer">pytest.exit()</a> is called, the loop is terminated immediately.</p><p>If at any point <code>session.shouldfail</code> or <code>session.shouldstop</code> are set, the loop is terminated after the runtest protocol for the current item is finished.</p><p><em>Parameters</em>:</p><ul><li><code>session (Session)</code> – The pytest session object.</li></ul><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>. The return value is not used, but only stops further processing.</p></li><li><p><strong>pytest_runtest_protocol</strong>(<code>item, nextitem</code>)</p><p>Perform the runtest protocol for a single test item.</p><p>The default runtest protocol is this (see individual hooks for full details):</p><p><code>pytest_runtest_logstart(nodeid, location)</code></p><p><em>Setup phase</em>:</p><ul><li><p><code>call = pytest_runtest_setup(item) (wrapped in CallInfo(when=&quot;setup&quot;))</code></p></li><li><p><code>report = pytest_runtest_makereport(item, call)</code></p></li><li><p><code>pytest_runtest_logreport(report)</code></p></li><li><p><code>pytest_exception_interact(call, report)</code> if an interactive exception occurred</p></li></ul><p><em>Call phase</em>, if the the setup passed and the <code>setuponly</code> pytest option is not set:</p><ul><li><p><code>call = pytest_runtest_call(item)</code> (wrapped in CallInfo(when=&quot;call&quot;))</p></li><li><p><code>report = pytest_runtest_makereport(item, call)</code></p></li><li><p><code>pytest_runtest_logreport(report)</code></p></li><li><p><code>pytest_exception_interact(call, report)</code> if an interactive exception occurred</p></li></ul><p><em>Teardown phase</em>:</p><ul><li><p><code>call = pytest_runtest_teardown(item, nextitem)</code> (wrapped in <code>CallInfo(when=&quot;teardown&quot;)</code>)</p></li><li><p><code>report = pytest_runtest_makereport(item, call)</code></p></li><li><p><code>pytest_runtest_logreport(report)</code></p></li><li><p><code>pytest_exception_interact(call, report)</code> if an interactive exception occurred</p></li></ul></li><li><p><strong>pytest_runtest_logfinish</strong>(<code>nodeid, location</code>)</p><p><em>Parameters</em>:</p><ul><li><p><code>item (Item)</code> – Test item for which the runtest protocol is performed.</p></li><li><p><code>nextitem (Optional[Item])</code> – The scheduled-to-be-next test item (or None if this is the end my friend).</p></li></ul><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>. The return value is not used, but only stops further processing.</p></li><li><p><strong>pytest_runtest_logstart</strong>(<code>nodeid, location</code>)</p><p>Called at the start of running the runtest protocol for a single item.</p><p>See <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_runtest_protocol" target="_blank" rel="noreferrer">pytest_runtest_protocol</a> for a description of the runtest protocol.</p><p><em>Parameters</em>:</p><ul><li><p><code>nodeid (str)</code> – Full node ID of the item.</p></li><li><p><code>location (Tuple[str, Optional[int], str])</code> – A tuple of <code>(filename, lineno, testname)</code> where filename is a file path relative to <code>config.rootpath</code> and <code>lineno</code> is 0-based.</p></li></ul></li><li><p><strong>pytest_runtest_logfinish</strong>(<code>nodeid, location</code>)</p><p>Called at the end of running the runtest protocol for a single item.</p><p>See <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_runtest_protocol" target="_blank" rel="noreferrer">pytest_runtest_protocol</a> for a description of the runtest protocol.</p><p><em>Parameters</em>:</p><ul><li><p><code>nodeid(str)</code> – Full node ID of the item.</p></li><li><p><code>location(Tuple[str, Optional[int], str])</code> – A tuple of <code>(filename, lineno, testname)</code> where <code>filename</code> is a file path relative to <code>config.rootpath</code> and <code>lineno</code> is 0-based.</p></li></ul></li><li><p><strong>pytest_runtest_setup</strong>(<code>item</code>)</p><p>Called to perform the setup phase for a test item.</p><p>The default implementation runs <code>setup()</code> on <code>item</code> and all of its parents (which haven’t been setup yet). This includes obtaining the values of fixtures required by the item (which haven’t been obtained yet).</p><p><em>Parameters</em>:</p><ul><li><code>item (Item)</code> – The item.</li></ul></li><li><p><strong>pytest_runtest_call</strong>(<code>item</code>)</p><p>Called to run the test for test item (the call phase).</p><p>The default implementation calls <code>item.runtest()</code>.</p><p><em>Parameters</em>:</p><ul><li><code>item (Item)</code> – The item.</li></ul></li><li><p><strong>pytest_runtest_teardown</strong>(<code>item, nextitem</code>)</p><p>Called to perform the teardown phase for a test item.</p><p>The default implementation runs the finalizers and calls <code>teardown()</code> on <code>item</code> and all of its parents (which need to be torn down). This includes running the teardown phase of fixtures required by the item (if they go out of scope).</p><p><em>Parameters</em>:</p><ul><li><p><code>item (Item)</code> – The item.</p></li><li><p><code>nextitem (Optional[Item])</code> – The scheduled-to-be-next test item (None if no further test item is scheduled). This argument is used to perform exact teardowns, i.e. calling just enough finalizers so that nextitem only needs to call setup functions.</p></li></ul></li><li><p><strong>pytest_runtest_makereport</strong>(<code>item, call</code>)</p><p>Called to create a <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.TestReport" target="_blank" rel="noreferrer">TestReport</a> for each of the setup, call and teardown runtest phases of a test item.</p><p>See <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_runtest_protocol" target="_blank" rel="noreferrer">pytest_runtest_protocol</a> for a description of the runtest protocol.</p><p><em>Parameters</em>:</p><ul><li><p><code>item (Item)</code> – The item.</p></li><li><p><code>call (CallInfo[None])</code> – The CallInfo for the phase.</p></li></ul><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p>For deeper understanding you may look at the default implementation of these hooks in <code>_pytest.runner</code> and maybe also in <code>_pytest.pdb</code> which interacts with <code>_pytest.capture</code> and its input/output capturing in order to immediately drop into interactive debugging when a test failure occurs.</p></li><li><p><strong>pytest_pyfunc_call</strong>(<code>pyfuncitem</code>)</p><p>Call underlying test function.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p><em>Parameters</em>:</p><ul><li><code>pyfuncitem (Function)</code> – The function item.</li></ul></li></ul><h2 id="reporting-hooks" tabindex="-1">Reporting hooks <a class="header-anchor" href="#reporting-hooks" aria-label="Permalink to &quot;Reporting hooks&quot;">​</a></h2><p>Session related reporting hooks:</p><ul><li><p><strong>pytest_collectstart</strong>(<code>collector</code>)</p><p>Collector starts collecting.</p><p><em>Parameters</em>:</p><ul><li><code>collector (Collector)</code> – The <code>collector</code>.</li></ul></li><li><p><strong>pytest_make_collect_report</strong>(<code>collector</code>)</p><p>Perform <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.Collector.collect" target="_blank" rel="noreferrer">collector.collect()</a> and return a <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.CollectReport" target="_blank" rel="noreferrer"><strong>CollectReport</strong></a>.</p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><p><em>Parameters</em>:</p><ul><li><code>collector (Collector)</code> – The <code>collector</code>.</li></ul></li><li><p><strong>pytest_itemcollected</strong>(<code>item</code>)</p><p>We just collected a test item.</p><p><em>Parameters</em>:</p><ul><li><code>item (Item)</code> – The <code>item</code>.</li></ul></li><li><p><strong>pytest_collectreport</strong>(<code>report</code>)</p><p>Collector finished collecting.</p><p><em>Parameters</em>:</p><ul><li><code>report(CollectReport)</code> – The collect report.</li></ul></li><li><p><strong>pytest_deselected</strong>(<code>items</code>)</p><p>Called for deselected test items, e.g. by keyword.</p><p>May be called multiple times.</p><p><em>Parameters</em>:</p><ul><li><code>items (Sequence[Item])</code> – The items.</li></ul></li><li><p><strong>pytest_report_header</strong>(<code>config, start_path, startdir</code>)</p><p>Return a string or list of strings to be displayed as header info for terminal reporting.</p><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest config object.</p></li><li><p><code>start_path (Path)</code> – The starting dir.</p></li><li><p><code>startdir (LEGACY_PATH)</code> – The starting dir (deprecated).</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Lines returned by a plugin are displayed before those of plugins which ran before it. If you want to have your line(s) displayed first, use <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#plugin-hookorder" target="_blank" rel="noreferrer">trylast=True</a>.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>This function should be implemented only in plugins or <code>conftest.py</code> files situated at the tests root directory due to how pytest <a href="https://docs.pytest.org/en/latest/how-to/writing_plugins.html#pluginorder" target="_blank" rel="noreferrer">discovers plugins during startup</a>.</p></div><p><em>Changed in version 7.0.0</em>: The <code>start_path</code> parameter was added as a <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" target="_blank" rel="noreferrer">pathlib.Path</a> equivalent of the <code>startdir</code> parameter. The <code>startdir</code> parameter has been deprecated.</p></li><li><p><strong>pytest_report_collectionfinish</strong>(<code>config, start_path, startdir, items</code>)</p><p>Return a string or list of strings to be displayed after collection has finished successfully.</p><p>These strings will be displayed after the standard “collected X items” message.</p><p><em>New in version 3.2</em>.</p><p><em>Parameters</em>:</p><ul><li><p>config (Config) – The pytest config object.</p></li><li><p>start_path (Path) – The starting dir.</p></li><li><p>startdir (LEGACY_PATH) – The starting dir (deprecated).</p></li><li><p>items (Sequence[Item]) – List of pytest items that are going to be executed; this list should not be modified.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Lines returned by a plugin are displayed before those of plugins which ran before it. If you want to have your line(s) displayed first, use <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#plugin-hookorder" target="_blank" rel="noreferrer">trylast=True</a>.</p></div><p><em>Changed in version 7.0.0</em>: The <code>start_path</code> parameter was added as a <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" target="_blank" rel="noreferrer">pathlib.Path</a> equivalent of the <code>startdir</code> parameter. The <code>startdir</code> parameter has been deprecated.</p></li><li><p><strong>pytest_report_teststatus</strong>(<code>report, config</code>)</p><p>Return result-category, shortletter and verbose word for status reporting.</p><p>The result-category is a category in which to count the result, for example “passed”, “skipped”, “error” or the empty string.</p><p>The shortletter is shown as testing progresses, for example “.”, “s”, “E” or the empty string.</p><p>The verbose word is shown as testing progresses in verbose mode, for example “PASSED”, “SKIPPED”, “ERROR” or the empty string.</p><p>pytest may style these implicitly according to the report outcome. To provide explicit styling, return a tuple for the verbose word, for example <code>&quot;rerun&quot;, &quot;R&quot;, (&quot;RERUN&quot;, {&quot;yellow&quot;: True})</code>.</p><p><em>Parameters</em>:</p><ul><li><p><code>report (Union[CollectReport, TestReport])</code> – The report object whose status is to be returned.</p></li><li><p><code>config (Config)</code> – The pytest <code>config</code> object.</p></li></ul><p><em>Returns</em>: The test status.</p><p><em>Return type</em>: <code>TestShortLogReport | Tuple[str, str, Union[str, Tuple[str, Mapping[str, bool]]]]</code></p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p></li><li><p><strong>pytest_report_to_serializable</strong>(<code>config, report</code>)</p><p>Serialize the given report object into a data structure suitable for sending over the wire, e.g. converted to JSON.</p><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest <code>config</code> object.</p></li><li><p><code>report (Union[CollectReport, TestReport])</code> – The report.</p></li></ul></li><li><p><strong>pytest_report_from_serializable</strong>(<code>config, data</code>)</p><p>Restore a report object previously serialized with <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_report_to_serializable" target="_blank" rel="noreferrer">pytest_report_to_serializable</a>.</p><p><em>Parameters</em>:</p><ul><li><code>config (Config)</code> – The pytest <code>config</code> object.</li></ul></li><li><p><strong>pytest_terminal_summary</strong>(<code>terminalreporter, exitstatus, config</code>)</p><p>Add a section to terminal summary reporting.</p><p><em>Parameters</em>:</p><ul><li><p><code>terminalreporter (TerminalReporter)</code> – The internal terminal reporter object.</p></li><li><p><code>exitstatus (ExitCode)</code> – The exit status that will be reported back to the OS.</p></li><li><p><code>config (Config)</code> – The pytest config object.</p></li></ul><p><em>New in version 4.2</em>: The <code>config</code> parameter.</p></li><li><p><strong>pytest_fixture_setup</strong>(<code>fixturedef, request</code>)</p><p>Perform fixture setup execution.</p><p><em>Parameters</em>:</p><ul><li><p><code>fixturdef</code> – The fixture definition object.</p></li><li><p><code>request (SubRequest)</code> – The fixture <code>request</code> object.</p></li></ul><p><em>Returns</em>: The return value of the call to the fixture function.</p><p><em>Return type</em>: <code>Optional[object]</code></p><p>Stops at first non-None result, see <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If the fixture function returns None, other implementations of this hook function will continue to be called, according to the behavior of the <a href="https://docs.pytest.org/en/latest/how-to/writing_hook_functions.html#firstresult" target="_blank" rel="noreferrer">firstresult: stop at first non-None result</a> option.</p></div></li><li><p><strong>pytest_fixture_post_finalizer</strong>(<code>fixturedef, request</code>)</p><p>Called after fixture teardown, but before the cache is cleared, so the fixture result <code>fixturedef.cached_result</code> is still available (not <code>None</code>).</p><p><em>Parameters</em>:</p><ul><li><p><code>fixturdef</code> – The fixture definition object.</p></li><li><p><code>request (SubRequest)</code> – The fixture <code>request</code> object.</p></li></ul></li><li><p><strong>pytest_warning_recorded</strong>(<code>warning_message, when, nodeid, location</code>)</p><p>Process a warning captured by the internal pytest warnings plugin.</p><p><em>Parameters</em>:</p><ul><li><p><code>warning_message (warnings.WarningMessage)</code> – The captured warning. This is the same object produced by <code>warnings.catch_warnings()</code>, and contains the same attributes as the parameters of <a href="https://docs.python.org/3/library/warnings.html#warnings.showwarning" target="_blank" rel="noreferrer">warnings.showwarning()</a>.</p></li><li><p><code>when (Literal[&#39;config&#39;, &#39;collect&#39;, &#39;runtest&#39;])</code> – Indicates when the warning was captured. Possible values:</p><ul><li><p><code>&quot;config&quot;</code>: during pytest configuration/initialization stage.</p></li><li><p><code>&quot;collect&quot;</code>: during test collection.</p></li><li><p><code>&quot;runtest&quot;</code>: during test execution.</p></li></ul></li><li><p><code>nodeid (str)</code> – Full id of the item.</p></li><li><p><code>location (Optional[Tuple[str, int, str]])</code> – When available, holds information about the execution context of the captured warning (filename, linenumber, function). <code>function</code> evaluates to <code>&lt;module&gt;</code> when the execution context is at the module level.</p></li></ul><p><em>New in version 6.0.</em></p></li></ul><p><em>Central hook for reporting about test execution</em>:</p><ul><li><p><strong>pytest_runtest_logreport</strong>(<code>report</code>)</p><p>Process the <a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest.TestReport" target="_blank" rel="noreferrer">TestReport</a> produced for each of the setup, call and teardown runtest phases of an item.</p><p>See <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_runtest_protocol" target="_blank" rel="noreferrer">pytest_runtest_protocol</a> for a description of the runtest protocol.</p></li></ul><p><em>Assertion related hooks</em>:</p><ul><li><p><strong>pytest_assertrepr_compare</strong>(<code>config, op, left, right</code>)</p><p>Return explanation for comparisons in failing assert expressions.</p><p>Return None for no custom explanation, otherwise return a list of strings. The strings will be joined by newlines but any newlines in a string will be escaped. Note that all but the first line will be indented slightly, the intention is for the first line to be a summary.</p><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest config object.</p></li><li><p><code>op (str)</code> – The operator, e.g. <code>&quot;==&quot;</code>, <code>&quot;!=&quot;</code>, <code>&quot;not in&quot;</code>.</p></li><li><p><code>left (object)</code> – The left operand.</p></li><li><p><code>right (object)</code> – The right operand.</p></li></ul></li><li><p><strong>pytest_assertion_pass</strong>(<code>item, lineno, orig, expl</code>)</p><p>Called whenever an assertion passes.</p><p><em>New in version 5.0</em>.</p><p>Use this hook to do some processing after a passing assertion. The original assertion information is available in the <code>orig</code> string and the pytest introspected assertion information is available in the <code>expl</code> string.</p><p>This hook must be explicitly enabled by the <code>enable_assertion_pass_hook</code> ini-file option:</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[pytest]</span></span>
<span class="line"><span style="color:#F07178;">enable_assertion_pass_hook</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">true</span></span></code></pre></div><p>You need to clean the <code>.pyc</code> files in your project directory and interpreter libraries when enabling this option, as assertions will require to be re-written.</p><p><em>Parameters</em>:</p><ul><li><p><code>item (Item)</code> – pytest item object of current test.</p></li><li><p><code>lineno (int)</code> – Line number of the assert statement.</p></li><li><p><code>orig (str)</code> – String with the original assertion.</p></li><li><p><code>expl (str)</code> – String with the assert explanation.</p></li></ul></li></ul><h2 id="debugging-interaction-hooks" tabindex="-1">Debugging/Interaction hooks <a class="header-anchor" href="#debugging-interaction-hooks" aria-label="Permalink to &quot;Debugging/Interaction hooks&quot;">​</a></h2><p>There are few hooks which can be used for special reporting or interaction with exceptions:</p><ul><li><p><strong>pytest_internalerror</strong>(<code>excrepr, excinfo</code>)</p><p>Called for internal errors.</p><p>Return True to suppress the fallback handling of printing an INTERNALERROR message directly to sys.stderr.</p><p><em>Parameters</em>:</p><ul><li><p><code>excrepr (ExceptionRepr)</code> – The exception repr object.</p></li><li><p><code>excinfo (ExceptionInfo[BaseException])</code> – The exception info.</p></li></ul></li><li><p><strong>pytest_keyboard_interrupt</strong>(<code>excinfo</code>)</p><p>Called for keyboard interrupt.</p><p><em>Parameters</em>:</p><ul><li><code>excinfo (ExceptionInfo[Union[KeyboardInterrupt, Exit]])</code> – The exception info.</li></ul></li><li><p><strong>pytest_exception_interact</strong>(<code>node, call, report</code>)</p><p>Called when an exception was raised which can potentially be interactively handled.</p><p>May be called during collection (see <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_make_collect_report" target="_blank" rel="noreferrer">pytest_make_collect_report</a>), in which case <code>report</code> is a <code>CollectReport</code>.</p><p>May be called during runtest of an item (see <a href="https://docs.pytest.org/en/latest/reference/reference.html#std-hook-pytest_runtest_protocol" target="_blank" rel="noreferrer">pytest_runtest_protocol</a>), in which case <code>report</code> is a <code>TestReport</code>.</p><p>This hook is not called if the exception that was raised is an internal exception like <code>skip.Exception</code>.</p><p><em>Parameters</em>:</p><ul><li><p><code>node (Union[Item, Collector])</code> – The item or collector.</p></li><li><p><code>call (CallInfo[Any])</code> – The call information. Contains the exception.</p></li><li><p><code>report (Union[CollectReport, TestReport])</code> – The collection or test report.</p></li></ul></li><li><p><strong>pytest_enter_pdb</strong>(<code>config, pdb</code>)</p><p>Called upon <code>pdb.set_trace()</code>.</p><p>Can be used by plugins to take special action just before the python debugger enters interactive mode.</p><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest <code>config</code> object.</p></li><li><p><code>pdb (pdb.Pdb)</code> – The <code>Pdb</code> instance.</p></li></ul></li><li><p><strong>pytest_leave_pdb</strong>(<code>config, pdb</code>)</p><p>Called when leaving pdb (e.g. with continue after pdb.set_trace()).</p><p>Can be used by plugins to take special action just after the python debugger leaves interactive mode.</p><p><em>Parameters</em>:</p><ul><li><p><code>config (Config)</code> – The pytest <code>config</code> object.</p></li><li><p><code>pdb (pdb.Pdb)</code> – The <code>Pdb</code> instance.</p></li></ul></li></ul>`,31),l=[s];function n(p,a,c,d,h,u){return t(),o("div",null,l)}const g=e(i,[["render",n]]);export{m as __pageData,g as default};
