import{_ as s,o as a,c as n,Q as p}from"./chunks/framework.01af844e.js";const u=JSON.parse('{"title":"Using SQLite 3 with Flask","description":"","frontmatter":{},"headers":[],"relativePath":"python/flask/user_guide/pattern/sqlite3.md","filePath":"python/flask/user_guide/pattern/sqlite3.md","lastUpdated":1692979908000}'),l={name:"python/flask/user_guide/pattern/sqlite3.md"},e=p(`<h1 id="using-sqlite-3-with-flask" tabindex="-1">Using SQLite 3 with Flask <a class="header-anchor" href="#using-sqlite-3-with-flask" aria-label="Permalink to &quot;Using SQLite 3 with Flask {#using-sqlite-3-with-flask}&quot;">​</a></h1><p>In Flask you can easily implement the opening of database connections on demand and closing them when the context dies (usually at the end of the request).</p><p>Here is a simple example of how you can use SQLite 3 with Flask:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> sqlite3</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">DATABASE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/path/to/database.db&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">get_db</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    db </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">getattr</span><span style="color:#E1E4E8;">(g, </span><span style="color:#9ECBFF;">&#39;_database&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> db </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        db </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> g._database </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> sqlite3.connect(</span><span style="color:#79B8FF;">DATABASE</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">@app.teardown_appcontext</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">close_connection</span><span style="color:#E1E4E8;">(exception):</span></span>
<span class="line"><span style="color:#E1E4E8;">    db </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">getattr</span><span style="color:#E1E4E8;">(g, </span><span style="color:#9ECBFF;">&#39;_database&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> db </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        db.close()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> sqlite3</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">DATABASE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/path/to/database.db&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">get_db</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    db </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">getattr</span><span style="color:#24292E;">(g, </span><span style="color:#032F62;">&#39;_database&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> db </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        db </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> g._database </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> sqlite3.connect(</span><span style="color:#005CC5;">DATABASE</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">@app.teardown_appcontext</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">close_connection</span><span style="color:#24292E;">(exception):</span></span>
<span class="line"><span style="color:#24292E;">    db </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">getattr</span><span style="color:#24292E;">(g, </span><span style="color:#032F62;">&#39;_database&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> db </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        db.close()</span></span></code></pre></div><p>Now, to use the database, the application must either have an active application context (which is always true if there is a request in flight) or create an application context itself. At that point the <code>get_db</code> function can be used to get the current database connection. Whenever the context is destroyed the database connection will be terminated.</p><p>Example:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">@app.route</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">index</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    cur </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> get_db().cursor()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">@app.route</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">index</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    cur </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> get_db().cursor()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">...</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Please keep in mind that the teardown request and appcontext functions are always executed, even if a before-request handler failed or was never executed. Because of this we have to make sure here that the database is there before we close it.</p></div><h2 id="connect-on-demand" tabindex="-1">Connect on Demand <a class="header-anchor" href="#connect-on-demand" aria-label="Permalink to &quot;Connect on Demand {#connect-on-demand}&quot;">​</a></h2><p>The upside of this approach (connecting on first use) is that this will only open the connection if truly necessary. If you want to use this code outside a request context you can use it in a Python shell by opening the application context by hand:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> app.app_context():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># now you can use get_db()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">with</span><span style="color:#24292E;"> app.app_context():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># now you can use get_db()</span></span></code></pre></div><h2 id="easy-querying" tabindex="-1">Easy Querying <a class="header-anchor" href="#easy-querying" aria-label="Permalink to &quot;Easy Querying {#easy-querying}&quot;">​</a></h2><p>Now in each request handling function you can access <code>get_db()</code> to get the current open database connection. To simplify working with SQLite, a row factory function is useful. It is executed for every result returned from the database to convert the result. For instance, in order to get dictionaries instead of tuples, this could be inserted into the <code>get_db</code> function we created above:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make_dicts</span><span style="color:#E1E4E8;">(cursor, row):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dict</span><span style="color:#E1E4E8;">((cursor.description[idx][</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">], value)</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> idx, value </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">enumerate</span><span style="color:#E1E4E8;">(row))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">db.row_factory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> make_dicts</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make_dicts</span><span style="color:#24292E;">(cursor, row):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dict</span><span style="color:#24292E;">((cursor.description[idx][</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">], value)</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> idx, value </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">enumerate</span><span style="color:#24292E;">(row))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">db.row_factory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> make_dicts</span></span></code></pre></div><p>This will make the sqlite3 module return dicts for this database connection, which are much nicer to deal with. Even more simply, we could place this in <code>get_db</code> instead:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">db.row_factory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> sqlite3.Row</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">db.row_factory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> sqlite3.Row</span></span></code></pre></div><p>This would use Row objects rather than dicts to return the results of queries. These are <code>namedtuple</code> s, so we can access them either by index or by key. For example, assuming we have a <code>sqlite3.Row</code> called r for the rows <code>id</code>, <code>FirstName</code>, <code>LastName</code>, and <code>MiddleInitial</code>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># You can get values based on the row&#39;s name</span></span>
<span class="line"><span style="color:#E1E4E8;">r[</span><span style="color:#9ECBFF;">&#39;FirstName&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">John</span></span>
<span class="line"><span style="color:#6A737D;"># Or, you can get them based on index</span></span>
<span class="line"><span style="color:#E1E4E8;">r[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">John</span></span>
<span class="line"><span style="color:#6A737D;"># Row objects are also iterable:</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> value </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> r:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(value)</span></span>
<span class="line"><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">John</span></span>
<span class="line"><span style="color:#E1E4E8;">Doe</span></span>
<span class="line"><span style="color:#E1E4E8;">M</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># You can get values based on the row&#39;s name</span></span>
<span class="line"><span style="color:#24292E;">r[</span><span style="color:#032F62;">&#39;FirstName&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">John</span></span>
<span class="line"><span style="color:#6A737D;"># Or, you can get them based on index</span></span>
<span class="line"><span style="color:#24292E;">r[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">John</span></span>
<span class="line"><span style="color:#6A737D;"># Row objects are also iterable:</span></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> value </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> r:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(value)</span></span>
<span class="line"><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">John</span></span>
<span class="line"><span style="color:#24292E;">Doe</span></span>
<span class="line"><span style="color:#24292E;">M</span></span></code></pre></div><p>Additionally, it is a good idea to provide a query function that combines getting the cursor, executing and fetching the results:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">query_db</span><span style="color:#E1E4E8;">(query, args</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(), one</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    cur </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> get_db().execute(query, args)</span></span>
<span class="line"><span style="color:#E1E4E8;">    rv </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> cur.fetchall()</span></span>
<span class="line"><span style="color:#E1E4E8;">    cur.close()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (rv[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> rv </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> one </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> rv</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">query_db</span><span style="color:#24292E;">(query, args</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(), one</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    cur </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> get_db().execute(query, args)</span></span>
<span class="line"><span style="color:#24292E;">    rv </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> cur.fetchall()</span></span>
<span class="line"><span style="color:#24292E;">    cur.close()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (rv[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> rv </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> one </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> rv</span></span></code></pre></div><p>This handy little function, in combination with a row factory, makes working with the database much more pleasant than it is by just using the raw cursor and connection objects.</p><p>Here is how you can use it:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> user </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> query_db(</span><span style="color:#9ECBFF;">&#39;select * from users&#39;</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(user[</span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&#39;has the id&#39;</span><span style="color:#E1E4E8;">, user[</span><span style="color:#9ECBFF;">&#39;user_id&#39;</span><span style="color:#E1E4E8;">])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> user </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> query_db(</span><span style="color:#032F62;">&#39;select * from users&#39;</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(user[</span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&#39;has the id&#39;</span><span style="color:#24292E;">, user[</span><span style="color:#032F62;">&#39;user_id&#39;</span><span style="color:#24292E;">])</span></span></code></pre></div><p>Or if you just want a single result:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> query_db(</span><span style="color:#9ECBFF;">&#39;select * from users where username = ?&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                [the_username], </span><span style="color:#FFAB70;">one</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> user </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;No such user&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(the_username, </span><span style="color:#9ECBFF;">&#39;has the id&#39;</span><span style="color:#E1E4E8;">, user[</span><span style="color:#9ECBFF;">&#39;user_id&#39;</span><span style="color:#E1E4E8;">])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> query_db(</span><span style="color:#032F62;">&#39;select * from users where username = ?&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                [the_username], </span><span style="color:#E36209;">one</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> user </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;No such user&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">else</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(the_username, </span><span style="color:#032F62;">&#39;has the id&#39;</span><span style="color:#24292E;">, user[</span><span style="color:#032F62;">&#39;user_id&#39;</span><span style="color:#24292E;">])</span></span></code></pre></div><p>To pass variable parts to the SQL statement, use a question mark in the statement and pass in the arguments as a list. Never directly add them to the SQL statement with string formatting because this makes it possible to attack the application using <a href="https://en.wikipedia.org/wiki/SQL_injection" target="_blank" rel="noreferrer">SQL Injections</a>.</p><h2 id="initial-schemas" tabindex="-1">Initial Schemas <a class="header-anchor" href="#initial-schemas" aria-label="Permalink to &quot;Initial Schemas {#initial-schemas}&quot;">​</a></h2><p>Relational databases need schemas, so applications often ship a <code>schema.sql</code> file that creates the database. It’s a good idea to provide a function that creates the database based on that schema. This function can do that for you:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">init_db</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> app.app_context():</span></span>
<span class="line"><span style="color:#E1E4E8;">        db </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> get_db()</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> app.open_resource(</span><span style="color:#9ECBFF;">&#39;schema.sql&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">mode</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;r&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> f:</span></span>
<span class="line"><span style="color:#E1E4E8;">            db.cursor().executescript(f.read())</span></span>
<span class="line"><span style="color:#E1E4E8;">        db.commit()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">init_db</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> app.app_context():</span></span>
<span class="line"><span style="color:#24292E;">        db </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> get_db()</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> app.open_resource(</span><span style="color:#032F62;">&#39;schema.sql&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">mode</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;r&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> f:</span></span>
<span class="line"><span style="color:#24292E;">            db.cursor().executescript(f.read())</span></span>
<span class="line"><span style="color:#24292E;">        db.commit()</span></span></code></pre></div><p>You can then create such a database from the Python shell:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> yourapplication </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> init_db</span></span>
<span class="line"><span style="color:#E1E4E8;">init_db()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> yourapplication </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> init_db</span></span>
<span class="line"><span style="color:#24292E;">init_db()</span></span></code></pre></div>`,31),o=[e];function t(c,r,i,y,E,d){return a(),n("div",null,o)}const F=s(l,[["render",t]]);export{u as __pageData,F as default};
