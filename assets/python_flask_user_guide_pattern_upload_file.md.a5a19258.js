import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.01af844e.js";const h=JSON.parse('{"title":"Uploading Files","description":"","frontmatter":{},"headers":[],"relativePath":"python/flask/user_guide/pattern/upload_file.md","filePath":"python/flask/user_guide/pattern/upload_file.md","lastUpdated":1693404008000}'),e={name:"python/flask/user_guide/pattern/upload_file.md"},o=l(`<h1 id="uploading-files" tabindex="-1">Uploading Files <a class="header-anchor" href="#uploading-files" aria-label="Permalink to &quot;Uploading Files {#uploading-files}&quot;">​</a></h1><p>Ah yes, the good old problem of file uploads. The basic idea of file uploads is actually quite simple. It basically works like this:</p><ol><li><p>A <code>&lt;form&gt;</code> tag is marked with <code>enctype=multipart/form-data</code> and an <code>&lt;input type=file&gt;</code> is placed in that form.</p></li><li><p>The application accesses the file from the <code>files</code> dictionary on the request object.</p></li><li><p>use the <code>save()</code> method of the file to save the file permanently somewhere on the filesystem.</p></li></ol><h2 id="a-gentle-introduction" tabindex="-1">A Gentle Introduction <a class="header-anchor" href="#a-gentle-introduction" aria-label="Permalink to &quot;A Gentle Introduction {#a-gentle-introduction}&quot;">​</a></h2><p>Let’s start with a very basic application that uploads a file to a specific upload folder and displays a file to the user. Let’s look at the bootstrapping code for our application:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> os</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Flask, flash, request, redirect, url_for</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> werkzeug.utils </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> secure_filename</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">UPLOAD_FOLDER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/path/to/the/uploads&#39;</span></span>
<span class="line"><span style="color:#79B8FF;">ALLOWED_EXTENSIONS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&#39;txt&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;pdf&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;png&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;jpg&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;jpeg&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;gif&#39;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Flask(</span><span style="color:#79B8FF;">__name__</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">app.config[</span><span style="color:#9ECBFF;">&#39;UPLOAD_FOLDER&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">UPLOAD_FOLDER</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> os</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Flask, flash, request, redirect, url_for</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> werkzeug.utils </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> secure_filename</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">UPLOAD_FOLDER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/path/to/the/uploads&#39;</span></span>
<span class="line"><span style="color:#005CC5;">ALLOWED_EXTENSIONS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&#39;txt&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;pdf&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;png&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;jpg&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;jpeg&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;gif&#39;</span><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Flask(</span><span style="color:#005CC5;">__name__</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">app.config[</span><span style="color:#032F62;">&#39;UPLOAD_FOLDER&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">UPLOAD_FOLDER</span></span></code></pre></div><p>So first we need a couple of imports. Most should be straightforward, the <code>werkzeug.secure_filename()</code> is explained a little bit later. The <code>UPLOAD_FOLDER</code> is where we will store the uploaded files and the <code>ALLOWED_EXTENSIONS</code> is the set of allowed file extensions.</p><p>Why do we limit the extensions that are allowed? You probably don’t want your users to be able to upload everything there if the server is directly sending out the data to the client. That way you can make sure that users are not able to upload HTML files that would cause XSS problems (see <a href="/python/flask/user_guide/security#cross-site-scripting-xss">Cross-Site Scripting (XSS)</a>). Also make sure to disallow <code>.php</code> files if the server executes them, but who has PHP installed on their server, right? 😃</p><p>Next the functions that check if an extension is valid and that uploads the file and redirects the user to the URL for the uploaded file:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">allowed_file</span><span style="color:#E1E4E8;">(filename):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> filename </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">           filename.rsplit(</span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">].lower() </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ALLOWED_EXTENSIONS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">@app.route</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">methods</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&#39;GET&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;POST&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">upload_file</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> request.method </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;POST&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># check if the post request has the file part</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;file&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> request.files:</span></span>
<span class="line"><span style="color:#E1E4E8;">            flash(</span><span style="color:#9ECBFF;">&#39;No file part&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> redirect(request.url)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> request.files[</span><span style="color:#9ECBFF;">&#39;file&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># If the user does not select a file, the browser submits an</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># empty file without a filename.</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;">.filename </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            flash(</span><span style="color:#9ECBFF;">&#39;No selected file&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> redirect(request.url)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> allowed_file(</span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;">.filename):</span></span>
<span class="line"><span style="color:#E1E4E8;">            filename </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> secure_filename(</span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;">.filename)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;">.save(os.path.join(app.config[</span><span style="color:#9ECBFF;">&#39;UPLOAD_FOLDER&#39;</span><span style="color:#E1E4E8;">], filename))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> redirect(url_for(</span><span style="color:#9ECBFF;">&#39;download_file&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">filename))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &lt;!doctype html&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &lt;title&gt;Upload new File&lt;/title&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &lt;h1&gt;Upload new File&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &lt;form method=post enctype=multipart/form-data&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">      &lt;input type=file name=file&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">      &lt;input type=submit value=Upload&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &lt;/form&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;&#39;&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">allowed_file</span><span style="color:#24292E;">(filename):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;.&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> filename </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">           filename.rsplit(</span><span style="color:#032F62;">&#39;.&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">].lower() </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ALLOWED_EXTENSIONS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">@app.route</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">methods</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&#39;GET&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;POST&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">upload_file</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> request.method </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;POST&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># check if the post request has the file part</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;file&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> request.files:</span></span>
<span class="line"><span style="color:#24292E;">            flash(</span><span style="color:#032F62;">&#39;No file part&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> redirect(request.url)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">file</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> request.files[</span><span style="color:#032F62;">&#39;file&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># If the user does not select a file, the browser submits an</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># empty file without a filename.</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#E36209;">file</span><span style="color:#24292E;">.filename </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            flash(</span><span style="color:#032F62;">&#39;No selected file&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> redirect(request.url)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#E36209;">file</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> allowed_file(</span><span style="color:#E36209;">file</span><span style="color:#24292E;">.filename):</span></span>
<span class="line"><span style="color:#24292E;">            filename </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> secure_filename(</span><span style="color:#E36209;">file</span><span style="color:#24292E;">.filename)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#E36209;">file</span><span style="color:#24292E;">.save(os.path.join(app.config[</span><span style="color:#032F62;">&#39;UPLOAD_FOLDER&#39;</span><span style="color:#24292E;">], filename))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> redirect(url_for(</span><span style="color:#032F62;">&#39;download_file&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">filename))</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#032F62;">    &lt;!doctype html&gt;</span></span>
<span class="line"><span style="color:#032F62;">    &lt;title&gt;Upload new File&lt;/title&gt;</span></span>
<span class="line"><span style="color:#032F62;">    &lt;h1&gt;Upload new File&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#032F62;">    &lt;form method=post enctype=multipart/form-data&gt;</span></span>
<span class="line"><span style="color:#032F62;">      &lt;input type=file name=file&gt;</span></span>
<span class="line"><span style="color:#032F62;">      &lt;input type=submit value=Upload&gt;</span></span>
<span class="line"><span style="color:#032F62;">    &lt;/form&gt;</span></span>
<span class="line"><span style="color:#032F62;">    &#39;&#39;&#39;</span></span></code></pre></div><p>So what does that <code>secure_filename()</code> function actually do? Now the problem is that there is that principle called “never trust user input”. This is also true for the filename of an uploaded file. All submitted form data can be forged, and filenames can be dangerous. For the moment just remember: always use that function to secure a filename before storing it directly on the filesystem.</p><div class="tip custom-block"><p class="custom-block-title">Information for the Pros</p><p>So you’re interested in what that <code>secure_filename()</code> function does and what the problem is if you’re not using it? So just imagine someone would send the following information as <code>filename</code> to your application:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">filename </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;../../../../home/username/.bashrc&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">filename </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;../../../../home/username/.bashrc&quot;</span></span></code></pre></div><p>Assuming the number of <code>../</code> is correct and you would join this with the <code>UPLOAD_FOLDER</code> the user might have the ability to modify a file on the server’s filesystem he or she should not modify. This does require some knowledge about how the application looks like, but trust me, hackers are patient 😃</p><p>Now let’s look how that function works:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">secure_filename(</span><span style="color:#9ECBFF;">&#39;../../../../home/username/.bashrc&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#9ECBFF;">&#39;home_username_.bashrc&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">secure_filename(</span><span style="color:#032F62;">&#39;../../../../home/username/.bashrc&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#032F62;">&#39;home_username_.bashrc&#39;</span></span></code></pre></div></div><p>We want to be able to serve the uploaded files so they can be downloaded by users. We’ll define a <code>download_file</code> view to serve files in the upload folder by name. <code>url_for(&quot;download_file&quot;, name=name)</code> generates download URLs.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> send_from_directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">@app.route</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/uploads/&lt;name&gt;&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">download_file</span><span style="color:#E1E4E8;">(name):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> send_from_directory(app.config[</span><span style="color:#9ECBFF;">&quot;UPLOAD_FOLDER&quot;</span><span style="color:#E1E4E8;">], name)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> send_from_directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">@app.route</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/uploads/&lt;name&gt;&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">download_file</span><span style="color:#24292E;">(name):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> send_from_directory(app.config[</span><span style="color:#032F62;">&quot;UPLOAD_FOLDER&quot;</span><span style="color:#24292E;">], name)</span></span></code></pre></div><p>If you’re using middleware or the HTTP server to serve files, you can register the <code>download_file</code> endpoint as <code>build_only</code> so <code>url_for</code> will work without a view function.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">app.add_url_rule(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;/uploads/&lt;name&gt;&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">endpoint</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;download_file&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">build_only</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">app.add_url_rule(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;/uploads/&lt;name&gt;&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">endpoint</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;download_file&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">build_only</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span></span>
<span class="line"><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="improving-uploads" tabindex="-1">Improving Uploads <a class="header-anchor" href="#improving-uploads" aria-label="Permalink to &quot;Improving Uploads {#improving-uploads}&quot;">​</a></h2><details class="details custom-block"><summary>Changelog</summary><p><em>New in version 0.6.</em></p></details><p>So how exactly does Flask handle uploads? Well it will store them in the webserver’s memory if the files are reasonably small, otherwise in a temporary location (as returned by <code>tempfile.gettempdir()</code>). But how do you specify the maximum file size after which an upload is aborted? By default Flask will happily accept file uploads with an unlimited amount of memory, but you can limit that by setting the <code>MAX_CONTENT_LENGTH</code> config key:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Flask, Request</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Flask(</span><span style="color:#79B8FF;">__name__</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">app.config[</span><span style="color:#9ECBFF;">&#39;MAX_CONTENT_LENGTH&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Flask, Request</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Flask(</span><span style="color:#005CC5;">__name__</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">app.config[</span><span style="color:#032F62;">&#39;MAX_CONTENT_LENGTH&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000</span></span></code></pre></div><p>The code above will limit the maximum allowed payload to 16 megabytes. If a larger file is transmitted, Flask will raise a <code>RequestEntityTooLarge</code> exception.</p><div class="tip custom-block"><p class="custom-block-title">Connection Reset Issue</p><p>When using the local development server, you may get a connection reset error instead of a 413 response. You will get the correct status response when running the app with a production WSGI server.</p></div><p>This feature was added in Flask 0.6 but can be achieved in older versions as well by subclassing the request object. For more information on that consult the Werkzeug documentation on file handling.</p><h2 id="upload-progress-bars" tabindex="-1">Upload Progress Bars <a class="header-anchor" href="#upload-progress-bars" aria-label="Permalink to &quot;Upload Progress Bars {#upload-progress-bars}&quot;">​</a></h2><p>A while ago many developers had the idea to read the incoming file in small chunks and store the upload progress in the database to be able to poll the progress with JavaScript from the client. The client asks the server every 5 seconds how much it has transmitted, but this is something it should already know.</p><h2 id="an-easier-solution" tabindex="-1">An Easier Solution <a class="header-anchor" href="#an-easier-solution" aria-label="Permalink to &quot;An Easier Solution {#an-easier-solution}&quot;">​</a></h2><p>Now there are better solutions that work faster and are more reliable. There are JavaScript libraries like <a href="https://jquery.com/" target="_blank" rel="noreferrer">jQuery</a> that have form plugins to ease the construction of progress bar.</p><p>Because the common pattern for file uploads exists almost unchanged in all applications dealing with uploads, there are also some Flask extensions that implement a full fledged upload mechanism that allows controlling which file extensions are allowed to be uploaded.</p>`,28),p=[o];function t(r,c,i,y,E,d){return a(),n("div",null,p)}const f=s(e,[["render",t]]);export{h as __pageData,f as default};
