import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.01af844e.js";const F=JSON.parse('{"title":"Logging","description":"","frontmatter":{},"headers":[],"relativePath":"python/flask/user_guide/logging.md","filePath":"python/flask/user_guide/logging.md","lastUpdated":1693328004000}'),o={name:"python/flask/user_guide/logging.md"},p=l(`<h1 id="logging" tabindex="-1">Logging <a class="header-anchor" href="#logging" aria-label="Permalink to &quot;Logging {#logging}&quot;">​</a></h1><p>Flask uses standard Python <code>logging</code>. Messages about your Flask application are logged with <code>app.logger</code>, which takes the same name as <code>app.name</code>. This logger can also be used to log your own messages.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">@app.route</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/login&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">methods</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&#39;POST&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">login</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> get_user(request.form[</span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> user.check_password(request.form[</span><span style="color:#9ECBFF;">&#39;password&#39;</span><span style="color:#E1E4E8;">]):</span></span>
<span class="line"><span style="color:#E1E4E8;">        login_user(user)</span></span>
<span class="line"><span style="color:#E1E4E8;">        app.logger.info(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">%s</span><span style="color:#9ECBFF;"> logged in successfully&#39;</span><span style="color:#E1E4E8;">, user.username)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> redirect(url_for(</span><span style="color:#9ECBFF;">&#39;index&#39;</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app.logger.info(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">%s</span><span style="color:#9ECBFF;"> failed to log in&#39;</span><span style="color:#E1E4E8;">, user.username)</span></span>
<span class="line"><span style="color:#E1E4E8;">        abort(</span><span style="color:#79B8FF;">401</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">@app.route</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/login&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">methods</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&#39;POST&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">login</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> get_user(request.form[</span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> user.check_password(request.form[</span><span style="color:#032F62;">&#39;password&#39;</span><span style="color:#24292E;">]):</span></span>
<span class="line"><span style="color:#24292E;">        login_user(user)</span></span>
<span class="line"><span style="color:#24292E;">        app.logger.info(</span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">%s</span><span style="color:#032F62;"> logged in successfully&#39;</span><span style="color:#24292E;">, user.username)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> redirect(url_for(</span><span style="color:#032F62;">&#39;index&#39;</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        app.logger.info(</span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">%s</span><span style="color:#032F62;"> failed to log in&#39;</span><span style="color:#24292E;">, user.username)</span></span>
<span class="line"><span style="color:#24292E;">        abort(</span><span style="color:#005CC5;">401</span><span style="color:#24292E;">)</span></span></code></pre></div><p>If you don’t configure logging, Python&#39;s default log level is usually ‘warning’. Nothing below the configured level will be visible.</p><h2 id="basic-configuration" tabindex="-1">Basic Configuration <a class="header-anchor" href="#basic-configuration" aria-label="Permalink to &quot;Basic Configuration {#basic-configuration}&quot;">​</a></h2><p>When you want to configure logging for your project, you should do it as soon as possible when the program starts. If <code>app.logger</code> is accessed before logging is configured, it will add a default handler. If possible, configure logging before creating the application object.</p><p>This example uses <code>dictConfig()</code> to create a logging configuration similar to Flask&#39;s default, except for all logs:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> logging.config </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> dictConfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">dictConfig({</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;version&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;formatters&#39;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&#39;default&#39;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;format&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;[</span><span style="color:#79B8FF;">%(asctime)s</span><span style="color:#9ECBFF;">] </span><span style="color:#79B8FF;">%(levelname)s</span><span style="color:#9ECBFF;"> in </span><span style="color:#79B8FF;">%(module)s</span><span style="color:#9ECBFF;">: </span><span style="color:#79B8FF;">%(message)s</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    }},</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;handlers&#39;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&#39;wsgi&#39;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;class&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;logging.StreamHandler&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;stream&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;ext://flask.logging.wsgi_errors_stream&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;formatter&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;default&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }},</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;root&#39;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;level&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;INFO&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;handlers&#39;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&#39;wsgi&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Flask(</span><span style="color:#79B8FF;">__name__</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> logging.config </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> dictConfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">dictConfig({</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;version&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;formatters&#39;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&#39;default&#39;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;format&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;[</span><span style="color:#005CC5;">%(asctime)s</span><span style="color:#032F62;">] </span><span style="color:#005CC5;">%(levelname)s</span><span style="color:#032F62;"> in </span><span style="color:#005CC5;">%(module)s</span><span style="color:#032F62;">: </span><span style="color:#005CC5;">%(message)s</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    }},</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;handlers&#39;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&#39;wsgi&#39;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;class&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;logging.StreamHandler&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;stream&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;ext://flask.logging.wsgi_errors_stream&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;formatter&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;default&#39;</span></span>
<span class="line"><span style="color:#24292E;">    }},</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;root&#39;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;level&#39;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;INFO&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;handlers&#39;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&#39;wsgi&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Flask(</span><span style="color:#005CC5;">__name__</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="default-configuration" tabindex="-1">Default Configuration <a class="header-anchor" href="#default-configuration" aria-label="Permalink to &quot;Default Configuration {#default-configuration}&quot;">​</a></h3><p>If you do not configure logging yourself, Flask will add a <code>StreamHandler</code> to <code>app.logger</code> automatically. During requests, it will write to the stream specified by the WSGI server in <code>environ[&#39;wsgi.errors&#39;]</code> (which is usually <code>sys.stderr</code>). Outside a request, it will log to <code>sys.stderr</code>.</p><h3 id="removing-the-default-handler" tabindex="-1">Removing the Default Handler <a class="header-anchor" href="#removing-the-default-handler" aria-label="Permalink to &quot;Removing the Default Handler {#removing-the-default-handler}&quot;">​</a></h3><p>If you configured logging after accessing <code>app.logger</code>, and need to remove the default handler, you can import and remove it:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask.logging </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> default_handler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app.logger.removeHandler(default_handler)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask.logging </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> default_handler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app.logger.removeHandler(default_handler)</span></span></code></pre></div><h2 id="email-errors-to-admins" tabindex="-1">Email Errors to Admins <a class="header-anchor" href="#email-errors-to-admins" aria-label="Permalink to &quot;Email Errors to Admins {#email-errors-to-admins}&quot;">​</a></h2><p>When running the application on a remote server for production, you probably won’t be looking at the log messages very often. The WSGI server will probably send log messages to a file, and you’ll only check that file if a user tells you something went wrong.</p><p>To be proactive about discovering and fixing bugs, you can configure a <code>logging.handlers.SMTPHandler</code> to send an email when errors and higher are logged.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> logging</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> logging.handlers </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> SMTPHandler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">mail_handler </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> SMTPHandler(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">mailhost</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;127.0.0.1&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">fromaddr</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;server-error@example.com&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">toaddrs</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&#39;admin@example.com&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">subject</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Application Error&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">mail_handler.setLevel(logging.</span><span style="color:#79B8FF;">ERROR</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">mail_handler.setFormatter(logging.Formatter(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;[</span><span style="color:#79B8FF;">%(asctime)s</span><span style="color:#9ECBFF;">] </span><span style="color:#79B8FF;">%(levelname)s</span><span style="color:#9ECBFF;"> in </span><span style="color:#79B8FF;">%(module)s</span><span style="color:#9ECBFF;">: </span><span style="color:#79B8FF;">%(message)s</span><span style="color:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> app.debug:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app.logger.addHandler(mail_handler)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> logging</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> logging.handlers </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> SMTPHandler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">mail_handler </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> SMTPHandler(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">mailhost</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;127.0.0.1&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">fromaddr</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;server-error@example.com&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">toaddrs</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&#39;admin@example.com&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">subject</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Application Error&#39;</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">mail_handler.setLevel(logging.</span><span style="color:#005CC5;">ERROR</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">mail_handler.setFormatter(logging.Formatter(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;[</span><span style="color:#005CC5;">%(asctime)s</span><span style="color:#032F62;">] </span><span style="color:#005CC5;">%(levelname)s</span><span style="color:#032F62;"> in </span><span style="color:#005CC5;">%(module)s</span><span style="color:#032F62;">: </span><span style="color:#005CC5;">%(message)s</span><span style="color:#032F62;">&#39;</span></span>
<span class="line"><span style="color:#24292E;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> app.debug:</span></span>
<span class="line"><span style="color:#24292E;">    app.logger.addHandler(mail_handler)</span></span></code></pre></div><p>This requires that you have an SMTP server set up on the same server. See the Python docs for more information about configuring the handler.</p><h2 id="injecting-request-information" tabindex="-1">Injecting Request Information <a class="header-anchor" href="#injecting-request-information" aria-label="Permalink to &quot;Injecting Request Information {#injecting-request-information}&quot;">​</a></h2><p>Seeing more information about the request, such as the IP address, may help debugging some errors. You can subclass <code>logging.Formatter</code> to inject your own fields that can be used in messages. You can change the formatter for Flask’s default handler, the mail handler defined above, or any other handler.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> has_request_context, request</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask.logging </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> default_handler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RequestFormatter</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">logging</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">Formatter</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">format</span><span style="color:#E1E4E8;">(self, record):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> has_request_context():</span></span>
<span class="line"><span style="color:#E1E4E8;">            record.url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> request.url</span></span>
<span class="line"><span style="color:#E1E4E8;">            record.remote_addr </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> request.remote_addr</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            record.url </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">            record.remote_addr </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">().format(record)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">formatter </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> RequestFormatter(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;[</span><span style="color:#79B8FF;">%(asctime)s</span><span style="color:#9ECBFF;">] </span><span style="color:#79B8FF;">%(remote_addr)s</span><span style="color:#9ECBFF;"> requested </span><span style="color:#79B8FF;">%(url)s\\n</span><span style="color:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">%(levelname)s</span><span style="color:#9ECBFF;"> in </span><span style="color:#79B8FF;">%(module)s</span><span style="color:#9ECBFF;">: </span><span style="color:#79B8FF;">%(message)s</span><span style="color:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">default_handler.setFormatter(formatter)</span></span>
<span class="line"><span style="color:#E1E4E8;">mail_handler.setFormatter(formatter)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> has_request_context, request</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask.logging </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> default_handler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RequestFormatter</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">logging</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">Formatter</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">format</span><span style="color:#24292E;">(self, record):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> has_request_context():</span></span>
<span class="line"><span style="color:#24292E;">            record.url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> request.url</span></span>
<span class="line"><span style="color:#24292E;">            record.remote_addr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> request.remote_addr</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">else</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            record.url </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">            record.remote_addr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">().format(record)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">formatter </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> RequestFormatter(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;[</span><span style="color:#005CC5;">%(asctime)s</span><span style="color:#032F62;">] </span><span style="color:#005CC5;">%(remote_addr)s</span><span style="color:#032F62;"> requested </span><span style="color:#005CC5;">%(url)s\\n</span><span style="color:#032F62;">&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">%(levelname)s</span><span style="color:#032F62;"> in </span><span style="color:#005CC5;">%(module)s</span><span style="color:#032F62;">: </span><span style="color:#005CC5;">%(message)s</span><span style="color:#032F62;">&#39;</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">default_handler.setFormatter(formatter)</span></span>
<span class="line"><span style="color:#24292E;">mail_handler.setFormatter(formatter)</span></span></code></pre></div><h2 id="other-libraries" tabindex="-1">Other Libraries <a class="header-anchor" href="#other-libraries" aria-label="Permalink to &quot;Other Libraries {#other-libraries}&quot;">​</a></h2><p>Other libraries may use logging extensively, and you want to see relevant messages from those logs too. The simplest way to do this is to add handlers to the root logger instead of only the app logger.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> flask.logging </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> default_handler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">root </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> logging.getLogger()</span></span>
<span class="line"><span style="color:#E1E4E8;">root.addHandler(default_handler)</span></span>
<span class="line"><span style="color:#E1E4E8;">root.addHandler(mail_handler)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> flask.logging </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> default_handler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">root </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> logging.getLogger()</span></span>
<span class="line"><span style="color:#24292E;">root.addHandler(default_handler)</span></span>
<span class="line"><span style="color:#24292E;">root.addHandler(mail_handler)</span></span></code></pre></div><p>Depending on your project, it may be more useful to configure each logger you care about separately, instead of configuring only the root logger.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> logger </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    app.logger,</span></span>
<span class="line"><span style="color:#E1E4E8;">    logging.getLogger(</span><span style="color:#9ECBFF;">&#39;sqlalchemy&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    logging.getLogger(</span><span style="color:#9ECBFF;">&#39;other_package&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    logger.addHandler(default_handler)</span></span>
<span class="line"><span style="color:#E1E4E8;">    logger.addHandler(mail_handler)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> logger </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">    app.logger,</span></span>
<span class="line"><span style="color:#24292E;">    logging.getLogger(</span><span style="color:#032F62;">&#39;sqlalchemy&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    logging.getLogger(</span><span style="color:#032F62;">&#39;other_package&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    logger.addHandler(default_handler)</span></span>
<span class="line"><span style="color:#24292E;">    logger.addHandler(mail_handler)</span></span></code></pre></div><h3 id="werkzeug" tabindex="-1">Werkzeug <a class="header-anchor" href="#werkzeug" aria-label="Permalink to &quot;Werkzeug {#werkzeug}&quot;">​</a></h3><p>Werkzeug logs basic request/response information to the <code>&#39;werkzeug&#39;</code> logger. If the root logger has no handlers configured, Werkzeug adds a <code>StreamHandler</code> to its logger.</p><h3 id="flask-extensions" tabindex="-1">Flask Extensions <a class="header-anchor" href="#flask-extensions" aria-label="Permalink to &quot;Flask Extensions {#flask-extensions}&quot;">​</a></h3><p>Depending on the situation, an extension may choose to log to <code>app.logger</code> or its own named logger. Consult each extension’s documentation for details.</p>`,30),e=[p];function r(t,c,i,E,y,d){return a(),n("div",null,e)}const u=s(o,[["render",r]]);export{F as __pageData,u as default};
