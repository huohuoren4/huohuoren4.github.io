import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.01af844e.js";const u=JSON.parse('{"title":"Set up a High Availability etcd Cluster with kubeadm","description":"","frontmatter":{},"headers":[],"relativePath":"container/k8s/get_started/prod_env/install/bootstrap/setup_etcd_cluster.md","filePath":"container/k8s/get_started/prod_env/install/bootstrap/setup_etcd_cluster.md","lastUpdated":1694607182000}'),p={name:"container/k8s/get_started/prod_env/install/bootstrap/setup_etcd_cluster.md"},e=l(`<h1 id="set-up-a-high-availability-etcd-cluster-with-kubeadm" tabindex="-1">Set up a High Availability etcd Cluster with kubeadm <a class="header-anchor" href="#set-up-a-high-availability-etcd-cluster-with-kubeadm" aria-label="Permalink to &quot;Set up a High Availability etcd Cluster with kubeadm&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>While kubeadm is being used as the management tool for external etcd nodes in this guide, please note that kubeadm does not plan to support certificate rotation or upgrades for such nodes. The long-term plan is to empower the tool <a href="https://github.com/kubernetes-sigs/etcdadm" target="_blank" rel="noreferrer">etcdadm</a> to manage these aspects.</p></div><p>By default, kubeadm runs a local etcd instance on each control plane node. It is also possible to treat the etcd cluster as external and provision etcd instances on separate hosts. The differences between the two approaches are covered in the <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology" target="_blank" rel="noreferrer">Options for Highly Available topology</a> page.</p><p>This task walks through the process of creating a high availability external etcd cluster of three members that can be used by kubeadm during cluster creation.</p><h2 id="before-you-begin" tabindex="-1">Before you begin <a class="header-anchor" href="#before-you-begin" aria-label="Permalink to &quot;Before you begin&quot;">​</a></h2><ul><li>Three hosts that can talk to each other over TCP ports 2379 and 2380. This document assumes these default ports. However, they are configurable through the kubeadm config file.</li><li>Each host must have systemd and a bash compatible shell installed.</li><li>Each host must <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" target="_blank" rel="noreferrer">have a container runtime, kubelet, and kubeadm installed</a>.</li><li>Each host should have access to the Kubernetes container image registry (<code>registry.k8s.io</code>) or list/pull the required etcd image using <code>kubeadm config images list/pull</code>. This guide - will set up etcd instances as <a href="https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/" target="_blank" rel="noreferrer">static pods</a> managed by a kubelet.</li><li>Some infrastructure to copy files between hosts. For example <code>ssh</code> and <code>scp</code> can satisfy this requirement.</li></ul><h2 id="setting-up-the-cluster" tabindex="-1">Setting up the cluster <a class="header-anchor" href="#setting-up-the-cluster" aria-label="Permalink to &quot;Setting up the cluster&quot;">​</a></h2><p>The general approach is to generate all certs on one node and only distribute the necessary files to the other nodes.</p><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>kubeadm contains all the necessary cryptographic machinery to generate the certificates described below; no other cryptographic tooling is required for this example.</p></div><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>The examples below use IPv4 addresses but you can also configure kubeadm, the kubelet and etcd to use IPv6 addresses. Dual-stack is supported by some Kubernetes options, but not by etcd. For more details on Kubernetes dual-stack support see <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/dual-stack-support/" target="_blank" rel="noreferrer">Dual-stack support with kubeadm</a>.</p></div><ol><li><p>Configure the kubelet to be a service manager for etcd.</p><div class="tip custom-block"><p class="custom-block-title">Note:</p><p>You must do this on every host where etcd should be running.</p></div><p>Since etcd was created first, you must override the service priority by creating a new unit file that has higher precedence than the kubeadm-provided kubelet unit file.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> /etc/systemd/system/kubelet.service.d/kubelet.conf</span></span>
<span class="line"><span style="color:#9ECBFF;"># Replace &quot;systemd&quot; with the cgroup driver of your container runtime. The default value in the kubelet is &quot;cgroupfs&quot;.</span></span>
<span class="line"><span style="color:#9ECBFF;"># Replace the value of &quot;containerRuntimeEndpoint&quot; for a different container runtime if needed.</span></span>
<span class="line"><span style="color:#9ECBFF;">#</span></span>
<span class="line"><span style="color:#9ECBFF;">apiVersion: kubelet.config.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#9ECBFF;">kind: KubeletConfiguration</span></span>
<span class="line"><span style="color:#9ECBFF;">authentication:</span></span>
<span class="line"><span style="color:#9ECBFF;">anonymous:</span></span>
<span class="line"><span style="color:#9ECBFF;">    enabled: false</span></span>
<span class="line"><span style="color:#9ECBFF;">webhook:</span></span>
<span class="line"><span style="color:#9ECBFF;">    enabled: false</span></span>
<span class="line"><span style="color:#9ECBFF;">authorization:</span></span>
<span class="line"><span style="color:#9ECBFF;">mode: AlwaysAllow</span></span>
<span class="line"><span style="color:#9ECBFF;">cgroupDriver: systemd</span></span>
<span class="line"><span style="color:#9ECBFF;">address: 127.0.0.1</span></span>
<span class="line"><span style="color:#9ECBFF;">containerRuntimeEndpoint: unix:///var/run/containerd/containerd.sock</span></span>
<span class="line"><span style="color:#9ECBFF;">staticPodPath: /etc/kubernetes/manifests</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> /etc/systemd/system/kubelet.service.d/20-etcd-service-manager.conf</span></span>
<span class="line"><span style="color:#9ECBFF;">[Service]</span></span>
<span class="line"><span style="color:#9ECBFF;">ExecStart=</span></span>
<span class="line"><span style="color:#9ECBFF;">ExecStart=/usr/bin/kubelet --config=/etc/systemd/system/kubelet.service.d/kubelet.conf</span></span>
<span class="line"><span style="color:#9ECBFF;">Restart=always</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon-reload</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /etc/systemd/system/kubelet.service.d/kubelet.conf</span></span>
<span class="line"><span style="color:#032F62;"># Replace &quot;systemd&quot; with the cgroup driver of your container runtime. The default value in the kubelet is &quot;cgroupfs&quot;.</span></span>
<span class="line"><span style="color:#032F62;"># Replace the value of &quot;containerRuntimeEndpoint&quot; for a different container runtime if needed.</span></span>
<span class="line"><span style="color:#032F62;">#</span></span>
<span class="line"><span style="color:#032F62;">apiVersion: kubelet.config.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#032F62;">kind: KubeletConfiguration</span></span>
<span class="line"><span style="color:#032F62;">authentication:</span></span>
<span class="line"><span style="color:#032F62;">anonymous:</span></span>
<span class="line"><span style="color:#032F62;">    enabled: false</span></span>
<span class="line"><span style="color:#032F62;">webhook:</span></span>
<span class="line"><span style="color:#032F62;">    enabled: false</span></span>
<span class="line"><span style="color:#032F62;">authorization:</span></span>
<span class="line"><span style="color:#032F62;">mode: AlwaysAllow</span></span>
<span class="line"><span style="color:#032F62;">cgroupDriver: systemd</span></span>
<span class="line"><span style="color:#032F62;">address: 127.0.0.1</span></span>
<span class="line"><span style="color:#032F62;">containerRuntimeEndpoint: unix:///var/run/containerd/containerd.sock</span></span>
<span class="line"><span style="color:#032F62;">staticPodPath: /etc/kubernetes/manifests</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /etc/systemd/system/kubelet.service.d/20-etcd-service-manager.conf</span></span>
<span class="line"><span style="color:#032F62;">[Service]</span></span>
<span class="line"><span style="color:#032F62;">ExecStart=</span></span>
<span class="line"><span style="color:#032F62;">ExecStart=/usr/bin/kubelet --config=/etc/systemd/system/kubelet.service.d/kubelet.conf</span></span>
<span class="line"><span style="color:#032F62;">Restart=always</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon-reload</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span></code></pre></div><p>Check the kubelet status to ensure it is running.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span></code></pre></div></li><li><p>Create configuration files for kubeadm.</p><p>Generate one kubeadm configuration file for each host that will have an etcd member running on it using the following script.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Update HOST0, HOST1 and HOST2 with the IPs of your hosts</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> HOST0</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.0</span><span style="color:#9ECBFF;">.0.6</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> HOST1</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.0</span><span style="color:#9ECBFF;">.0.7</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> HOST2</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.0</span><span style="color:#9ECBFF;">.0.8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Update NAME0, NAME1 and NAME2 with the hostnames of your hosts</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> NAME0</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;infra0&quot;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> NAME1</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;infra1&quot;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> NAME2</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;infra2&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Create temp directories to store files that will end up on other hosts</span></span>
<span class="line"><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST0}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST1}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST2}</span><span style="color:#9ECBFF;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">HOSTS</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(\${HOST0} \${HOST1} \${HOST2})</span></span>
<span class="line"><span style="color:#E1E4E8;">NAMES</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(\${NAME0} \${NAME1} \${NAME2})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">HOSTS</span><span style="color:#9ECBFF;">[@]}&quot;</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">HOST</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">\${HOSTS[$i]}</span></span>
<span class="line"><span style="color:#E1E4E8;">NAME</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">\${NAMES[$i]}</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> /tmp/\${HOST}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">---</span></span>
<span class="line"><span style="color:#9ECBFF;">apiVersion: &quot;kubeadm.k8s.io/v1beta3&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">kind: InitConfiguration</span></span>
<span class="line"><span style="color:#9ECBFF;">nodeRegistration:</span></span>
<span class="line"><span style="color:#9ECBFF;">    name: \${</span><span style="color:#E1E4E8;">NAME</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#9ECBFF;">localAPIEndpoint:</span></span>
<span class="line"><span style="color:#9ECBFF;">    advertiseAddress: \${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#9ECBFF;">---</span></span>
<span class="line"><span style="color:#9ECBFF;">apiVersion: &quot;kubeadm.k8s.io/v1beta3&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">kind: ClusterConfiguration</span></span>
<span class="line"><span style="color:#9ECBFF;">etcd:</span></span>
<span class="line"><span style="color:#9ECBFF;">    local:</span></span>
<span class="line"><span style="color:#9ECBFF;">        serverCertSANs:</span></span>
<span class="line"><span style="color:#9ECBFF;">        - &quot;\${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">        peerCertSANs:</span></span>
<span class="line"><span style="color:#9ECBFF;">        - &quot;\${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">        extraArgs:</span></span>
<span class="line"><span style="color:#9ECBFF;">            initial-cluster: \${</span><span style="color:#E1E4E8;">NAMES</span><span style="color:#9ECBFF;">[0]}=https://\${</span><span style="color:#E1E4E8;">HOSTS</span><span style="color:#9ECBFF;">[0]}:2380,\${</span><span style="color:#E1E4E8;">NAMES</span><span style="color:#9ECBFF;">[1]}=https://\${</span><span style="color:#E1E4E8;">HOSTS</span><span style="color:#9ECBFF;">[1]}:2380,\${</span><span style="color:#E1E4E8;">NAMES</span><span style="color:#9ECBFF;">[2]}=https://\${</span><span style="color:#E1E4E8;">HOSTS</span><span style="color:#9ECBFF;">[2]}:2380</span></span>
<span class="line"><span style="color:#9ECBFF;">            initial-cluster-state: new</span></span>
<span class="line"><span style="color:#9ECBFF;">            name: \${</span><span style="color:#E1E4E8;">NAME</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#9ECBFF;">            listen-peer-urls: https://\${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}:2380</span></span>
<span class="line"><span style="color:#9ECBFF;">            listen-client-urls: https://\${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}:2379</span></span>
<span class="line"><span style="color:#9ECBFF;">            advertise-client-urls: https://\${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}:2379</span></span>
<span class="line"><span style="color:#9ECBFF;">            initial-advertise-peer-urls: https://\${</span><span style="color:#E1E4E8;">HOST</span><span style="color:#9ECBFF;">}:2380</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Update HOST0, HOST1 and HOST2 with the IPs of your hosts</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> HOST0</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10.0</span><span style="color:#032F62;">.0.6</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> HOST1</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10.0</span><span style="color:#032F62;">.0.7</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> HOST2</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10.0</span><span style="color:#032F62;">.0.8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Update NAME0, NAME1 and NAME2 with the hostnames of your hosts</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> NAME0</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;infra0&quot;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> NAME1</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;infra1&quot;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> NAME2</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;infra2&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Create temp directories to store files that will end up on other hosts</span></span>
<span class="line"><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST0}</span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST1}</span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST2}</span><span style="color:#032F62;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">HOSTS</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(\${HOST0} \${HOST1} \${HOST2})</span></span>
<span class="line"><span style="color:#24292E;">NAMES</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(\${NAME0} \${NAME1} \${NAME2})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">HOSTS</span><span style="color:#032F62;">[@]}&quot;</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">HOST</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">\${HOSTS[$i]}</span></span>
<span class="line"><span style="color:#24292E;">NAME</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">\${NAMES[$i]}</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /tmp/\${HOST}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#032F62;">---</span></span>
<span class="line"><span style="color:#032F62;">apiVersion: &quot;kubeadm.k8s.io/v1beta3&quot;</span></span>
<span class="line"><span style="color:#032F62;">kind: InitConfiguration</span></span>
<span class="line"><span style="color:#032F62;">nodeRegistration:</span></span>
<span class="line"><span style="color:#032F62;">    name: \${</span><span style="color:#24292E;">NAME</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#032F62;">localAPIEndpoint:</span></span>
<span class="line"><span style="color:#032F62;">    advertiseAddress: \${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#032F62;">---</span></span>
<span class="line"><span style="color:#032F62;">apiVersion: &quot;kubeadm.k8s.io/v1beta3&quot;</span></span>
<span class="line"><span style="color:#032F62;">kind: ClusterConfiguration</span></span>
<span class="line"><span style="color:#032F62;">etcd:</span></span>
<span class="line"><span style="color:#032F62;">    local:</span></span>
<span class="line"><span style="color:#032F62;">        serverCertSANs:</span></span>
<span class="line"><span style="color:#032F62;">        - &quot;\${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#032F62;">        peerCertSANs:</span></span>
<span class="line"><span style="color:#032F62;">        - &quot;\${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#032F62;">        extraArgs:</span></span>
<span class="line"><span style="color:#032F62;">            initial-cluster: \${</span><span style="color:#24292E;">NAMES</span><span style="color:#032F62;">[0]}=https://\${</span><span style="color:#24292E;">HOSTS</span><span style="color:#032F62;">[0]}:2380,\${</span><span style="color:#24292E;">NAMES</span><span style="color:#032F62;">[1]}=https://\${</span><span style="color:#24292E;">HOSTS</span><span style="color:#032F62;">[1]}:2380,\${</span><span style="color:#24292E;">NAMES</span><span style="color:#032F62;">[2]}=https://\${</span><span style="color:#24292E;">HOSTS</span><span style="color:#032F62;">[2]}:2380</span></span>
<span class="line"><span style="color:#032F62;">            initial-cluster-state: new</span></span>
<span class="line"><span style="color:#032F62;">            name: \${</span><span style="color:#24292E;">NAME</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#032F62;">            listen-peer-urls: https://\${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}:2380</span></span>
<span class="line"><span style="color:#032F62;">            listen-client-urls: https://\${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}:2379</span></span>
<span class="line"><span style="color:#032F62;">            advertise-client-urls: https://\${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}:2379</span></span>
<span class="line"><span style="color:#032F62;">            initial-advertise-peer-urls: https://\${</span><span style="color:#24292E;">HOST</span><span style="color:#032F62;">}:2380</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span></code></pre></div></li><li><p>Generate the certificate authority.</p><p>If you already have a CA then the only action that is copying the CA&#39;s crt and key file to <code>/etc/kubernetes/pki/etcd/ca.crt</code> and <code>/etc/kubernetes/pki/etcd/ca.key</code>. After those files have been copied, proceed to the next step, &quot;Create certificates for each member&quot;.</p><p>If you do not already have a CA then run this command on <code>$HOST0</code> (where you generated the configuration files for kubeadm).</p><p>kubeadm init phase certs etcd-ca This creates two files:</p><ul><li><code>/etc/kubernetes/pki/etcd/ca.crt</code></li><li><code>/etc/kubernetes/pki/etcd/ca.key</code></li></ul></li><li><p>reate certificates for each member.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-server</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST2</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-peer</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST2</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-healthcheck-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST2</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apiserver-etcd-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST2</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/kubernetes/pki</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST2}</span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#6A737D;"># cleanup non-reusable certificates</span></span>
<span class="line"><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/kubernetes/pki</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-not</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca.crt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-not</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-delete</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-server</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST1</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-peer</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST1</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-healthcheck-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST1</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apiserver-etcd-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST1</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/kubernetes/pki</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST1}</span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/kubernetes/pki</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-not</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca.crt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-not</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-delete</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-server</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST0</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-peer</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST0</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd-healthcheck-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST0</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apiserver-etcd-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST0</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># No need to move the certs because they are for HOST0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># clean up certs that should not be copied off this host</span></span>
<span class="line"><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST2} </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-delete</span></span>
<span class="line"><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST1} </span><span style="color:#79B8FF;">-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-delete</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-server</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST2</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-peer</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST2</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-healthcheck-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST2</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apiserver-etcd-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST2</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/kubernetes/pki</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST2}</span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#6A737D;"># cleanup non-reusable certificates</span></span>
<span class="line"><span style="color:#6F42C1;">find</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/kubernetes/pki</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-not</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca.crt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-not</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-delete</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-server</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST1</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-peer</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST1</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-healthcheck-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST1</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apiserver-etcd-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST1</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/kubernetes/pki</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST1}</span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#6F42C1;">find</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/kubernetes/pki</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-not</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca.crt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-not</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-delete</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-server</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST0</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-peer</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST0</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd-healthcheck-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST0</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apiserver-etcd-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST0</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># No need to move the certs because they are for HOST0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># clean up certs that should not be copied off this host</span></span>
<span class="line"><span style="color:#6F42C1;">find</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST2} </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-delete</span></span>
<span class="line"><span style="color:#6F42C1;">find</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST1} </span><span style="color:#005CC5;">-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-delete</span></span></code></pre></div></li><li><p>Copy certificates and kubeadm configs.</p><p>The certificates have been generated and now they must be moved to their respective hosts.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">USER</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ubuntu</span></span>
<span class="line"><span style="color:#E1E4E8;">HOST</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">\${HOST1}</span></span>
<span class="line"><span style="color:#B392F0;">scp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;">\${HOST}</span><span style="color:#9ECBFF;">/</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> \${USER}</span><span style="color:#9ECBFF;">@</span><span style="color:#E1E4E8;">\${HOST}</span><span style="color:#9ECBFF;">:</span></span>
<span class="line"><span style="color:#B392F0;">ssh</span><span style="color:#E1E4E8;"> \${USER}</span><span style="color:#9ECBFF;">@</span><span style="color:#E1E4E8;">\${HOST}</span></span>
<span class="line"><span style="color:#B392F0;">USER@HOST</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Es</span></span>
<span class="line"><span style="color:#B392F0;">root@HOST</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root:root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pki</span></span>
<span class="line"><span style="color:#B392F0;">root@HOST</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pki</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/kubernetes/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">USER</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ubuntu</span></span>
<span class="line"><span style="color:#24292E;">HOST</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">\${HOST1}</span></span>
<span class="line"><span style="color:#6F42C1;">scp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;">\${HOST}</span><span style="color:#032F62;">/</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> \${USER}</span><span style="color:#032F62;">@</span><span style="color:#24292E;">\${HOST}</span><span style="color:#032F62;">:</span></span>
<span class="line"><span style="color:#6F42C1;">ssh</span><span style="color:#24292E;"> \${USER}</span><span style="color:#032F62;">@</span><span style="color:#24292E;">\${HOST}</span></span>
<span class="line"><span style="color:#6F42C1;">USER@HOST</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">sudo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Es</span></span>
<span class="line"><span style="color:#6F42C1;">root@HOST</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">chown</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root:root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pki</span></span>
<span class="line"><span style="color:#6F42C1;">root@HOST</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pki</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/kubernetes/</span></span></code></pre></div></li><li><p>Ensure all expected files exist.</p><p>The complete list of required files on <code>$HOST0</code> is:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/tmp/\${HOST0}</span></span>
<span class="line"><span style="color:#e1e4e8;">└── kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#e1e4e8;">---</span></span>
<span class="line"><span style="color:#e1e4e8;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#e1e4e8;">├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">├── apiserver-etcd-client.key</span></span>
<span class="line"><span style="color:#e1e4e8;">└── etcd</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── ca.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── ca.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── healthcheck-client.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── peer.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── peer.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── server.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    └── server.key</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/tmp/\${HOST0}</span></span>
<span class="line"><span style="color:#24292e;">└── kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#24292e;">---</span></span>
<span class="line"><span style="color:#24292e;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#24292e;">├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#24292e;">├── apiserver-etcd-client.key</span></span>
<span class="line"><span style="color:#24292e;">└── etcd</span></span>
<span class="line"><span style="color:#24292e;">    ├── ca.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── ca.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── healthcheck-client.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── peer.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── peer.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── server.crt</span></span>
<span class="line"><span style="color:#24292e;">    └── server.key</span></span></code></pre></div><p>On <code>$HOST1</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$HOME</span></span>
<span class="line"><span style="color:#e1e4e8;">└── kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#e1e4e8;">---</span></span>
<span class="line"><span style="color:#e1e4e8;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#e1e4e8;">├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">├── apiserver-etcd-client.key</span></span>
<span class="line"><span style="color:#e1e4e8;">└── etcd</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── ca.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── healthcheck-client.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── peer.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── peer.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── server.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    └── server.key</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$HOME</span></span>
<span class="line"><span style="color:#24292e;">└── kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#24292e;">---</span></span>
<span class="line"><span style="color:#24292e;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#24292e;">├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#24292e;">├── apiserver-etcd-client.key</span></span>
<span class="line"><span style="color:#24292e;">└── etcd</span></span>
<span class="line"><span style="color:#24292e;">    ├── ca.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── healthcheck-client.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── peer.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── peer.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── server.crt</span></span>
<span class="line"><span style="color:#24292e;">    └── server.key</span></span></code></pre></div><p>On <code>$HOST2</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$HOME</span></span>
<span class="line"><span style="color:#e1e4e8;">└── kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#e1e4e8;">---</span></span>
<span class="line"><span style="color:#e1e4e8;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#e1e4e8;">├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">├── apiserver-etcd-client.key</span></span>
<span class="line"><span style="color:#e1e4e8;">└── etcd</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── ca.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── healthcheck-client.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── peer.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── peer.key</span></span>
<span class="line"><span style="color:#e1e4e8;">    ├── server.crt</span></span>
<span class="line"><span style="color:#e1e4e8;">    └── server.key</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$HOME</span></span>
<span class="line"><span style="color:#24292e;">└── kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#24292e;">---</span></span>
<span class="line"><span style="color:#24292e;">/etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#24292e;">├── apiserver-etcd-client.crt</span></span>
<span class="line"><span style="color:#24292e;">├── apiserver-etcd-client.key</span></span>
<span class="line"><span style="color:#24292e;">└── etcd</span></span>
<span class="line"><span style="color:#24292e;">    ├── ca.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── healthcheck-client.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── healthcheck-client.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── peer.crt</span></span>
<span class="line"><span style="color:#24292e;">    ├── peer.key</span></span>
<span class="line"><span style="color:#24292e;">    ├── server.crt</span></span>
<span class="line"><span style="color:#24292e;">    └── server.key</span></span></code></pre></div></li><li><p>Create the static pod manifests.</p><p>Now that the certificates and configs are in place it&#39;s time to create the manifests. On each host run the <code>kubeadm</code> command to generate a static manifest for etcd.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">root@HOST0</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=/tmp/\${</span><span style="color:#E1E4E8;">HOST0</span><span style="color:#79B8FF;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">root@HOST1</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=</span><span style="color:#E1E4E8;">$HOME</span><span style="color:#79B8FF;">/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#B392F0;">root@HOST2</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">phase</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config=</span><span style="color:#E1E4E8;">$HOME</span><span style="color:#79B8FF;">/kubeadmcfg.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">root@HOST0</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">local</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=/tmp/\${</span><span style="color:#24292E;">HOST0</span><span style="color:#005CC5;">}/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">root@HOST1</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">local</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=</span><span style="color:#24292E;">$HOME</span><span style="color:#005CC5;">/kubeadmcfg.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">root@HOST2</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init</span><span style="color:#24292E;"> </span><span style="color:#032F62;">phase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">local</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config=</span><span style="color:#24292E;">$HOME</span><span style="color:#005CC5;">/kubeadmcfg.yaml</span></span></code></pre></div></li><li><p>Optional: Check the cluster health.</p><p>If <code>etcdctl</code> isn&#39;t available, you can run this tool inside a container image. You would do that directly with your container runtime using a tool such as <code>crictl run</code> and not through Kubernetes</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--cert </span><span style="color:#9ECBFF;">/etc/kubernetes/pki/etcd/peer.crt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--key </span><span style="color:#9ECBFF;">/etc/kubernetes/pki/etcd/peer.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--cacert </span><span style="color:#9ECBFF;">/etc/kubernetes/pki/etcd/ca.crt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--endpoints </span><span style="color:#9ECBFF;">https://</span><span style="color:#E1E4E8;">\${HOST0}</span><span style="color:#9ECBFF;">:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">health</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#B392F0;">https://[HOST0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">IP]:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">healthy:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proposal:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">took</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16.283339</span><span style="color:#9ECBFF;">ms</span></span>
<span class="line"><span style="color:#B392F0;">https://[HOST1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">IP]:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">healthy:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proposal:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">took</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19.44402</span><span style="color:#9ECBFF;">ms</span></span>
<span class="line"><span style="color:#B392F0;">https://[HOST2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">IP]:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">healthy:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proposal:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">took</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">35.926451</span><span style="color:#9ECBFF;">ms</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">etcdctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--cert </span><span style="color:#032F62;">/etc/kubernetes/pki/etcd/peer.crt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--key </span><span style="color:#032F62;">/etc/kubernetes/pki/etcd/peer.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--cacert </span><span style="color:#032F62;">/etc/kubernetes/pki/etcd/ca.crt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--endpoints </span><span style="color:#032F62;">https://</span><span style="color:#24292E;">\${HOST0}</span><span style="color:#032F62;">:2379</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">health</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#6F42C1;">https://[HOST0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">IP]:2379</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">healthy:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proposal:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">took</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16.283339</span><span style="color:#032F62;">ms</span></span>
<span class="line"><span style="color:#6F42C1;">https://[HOST1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">IP]:2379</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">healthy:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proposal:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">took</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19.44402</span><span style="color:#032F62;">ms</span></span>
<span class="line"><span style="color:#6F42C1;">https://[HOST2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">IP]:2379</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">healthy:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proposal:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">took</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">35.926451</span><span style="color:#032F62;">ms</span></span></code></pre></div><ul><li>Set <code>\${HOST0}to</code> the IP address of the host you are testing.</li></ul></li></ol><h2 id="what-s-next" tabindex="-1">What&#39;s next <a class="header-anchor" href="#what-s-next" aria-label="Permalink to &quot;What&#39;s next&quot;">​</a></h2><p>Once you have an etcd cluster with 3 working members, you can continue setting up a highly available control plane using the <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/" target="_blank" rel="noreferrer">external etcd method with kubeadm</a>.</p>`,13),o=[e];function t(c,r,y,E,i,F){return n(),a("div",null,o)}const h=s(p,[["render",t]]);export{u as __pageData,h as default};
