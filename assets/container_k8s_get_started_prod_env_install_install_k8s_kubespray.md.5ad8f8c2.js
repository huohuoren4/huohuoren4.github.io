import{_ as e,o as r,c as a,Q as t}from"./chunks/framework.01af844e.js";const y=JSON.parse('{"title":"Installing Kubernetes with Kubespray","description":"","frontmatter":{},"headers":[],"relativePath":"container/k8s/get_started/prod_env/install/install_k8s_kubespray.md","filePath":"container/k8s/get_started/prod_env/install/install_k8s_kubespray.md","lastUpdated":1694607182000}'),s={name:"container/k8s/get_started/prod_env/install/install_k8s_kubespray.md"},o=t(`<h1 id="installing-kubernetes-with-kubespray" tabindex="-1">Installing Kubernetes with Kubespray <a class="header-anchor" href="#installing-kubernetes-with-kubespray" aria-label="Permalink to &quot;Installing Kubernetes with Kubespray&quot;">​</a></h1><p>This quickstart helps to install a Kubernetes cluster hosted on GCE, Azure, OpenStack, AWS, vSphere, Equinix Metal (formerly Packet), Oracle Cloud Infrastructure (Experimental) or Baremetal with <a href="https://github.com/kubernetes-sigs/kubespray" target="_blank" rel="noreferrer">Kubespray</a>.</p><p>Kubespray is a composition of <a href="https://docs.ansible.com/" target="_blank" rel="noreferrer">Ansible</a> playbooks, <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/ansible.md#inventory" target="_blank" rel="noreferrer">inventory</a>, provisioning tools, and domain knowledge for generic OS/Kubernetes clusters configuration management tasks.</p><p>Kubespray provides:</p><ul><li><p>Highly available cluster.</p></li><li><p>Composable (Choice of the network plugin for instance).</p></li><li><p>Supports most popular Linux distributions:|</p><ul><li>Flatcar Container Linux by Kinvolk</li><li>Debian Bullseye, Buster, Jessie, Stretch</li><li>Ubuntu 16.04, 18.04, 20.04, 22.04</li><li>CentOS/RHEL 7, 8, 9</li><li>Fedora 35, 36</li><li>Fedora CoreOS</li><li>openSUSE Leap 15.x/Tumbleweed</li><li>Oracle Linux 7, 8, 9</li><li>Alma Linux 8, 9</li><li>Rocky Linux 8, 9</li><li>Kylin Linux Advanced Server V10</li><li>Amazon Linux 2</li></ul></li><li><p>Continuous integration tests.</p></li></ul><p>To choose a tool which best fits your use case, read <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/comparisons.md" target="_blank" rel="noreferrer">this comparison</a> to <a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/" target="_blank" rel="noreferrer">kubeadm</a> and <a href="https://kubernetes.io/docs/setup/production-environment/tools/kops/" target="_blank" rel="noreferrer">kops</a>.</p><h2 id="creating-a-cluster" tabindex="-1">Creating a cluster <a class="header-anchor" href="#creating-a-cluster" aria-label="Permalink to &quot;Creating a cluster&quot;">​</a></h2><h3 id="_1-5-meet-the-underlay-requirements" tabindex="-1">(1/5) Meet the underlay requirements <a class="header-anchor" href="#_1-5-meet-the-underlay-requirements" aria-label="Permalink to &quot;(1/5) Meet the underlay requirements&quot;">​</a></h3><p>Provision servers with the following <a href="https://github.com/kubernetes-sigs/kubespray#requirements" target="_blank" rel="noreferrer">requirements</a>:</p><ul><li>Minimum required version of Kubernetes is v1.22</li><li>Ansible v2.11+, Jinja 2.11+ and python-netaddr is installed on the machine that will run Ansible commands</li><li>The target servers must have access to the Internet in order to pull docker images. Otherwise, additional configuration is required See (<a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/offline-environment.md" target="_blank" rel="noreferrer">Offline Environment</a>)</li><li>The target servers are configured to allow IPv4 forwarding.</li><li>If using IPv6 for pods and services, the target servers are configured to allow IPv6 forwarding.</li><li>The firewalls are not managed, you&#39;ll need to implement your own rules the way you used to. in order to avoid any issue during deployment you should disable your firewall.</li><li>If kubespray is run from non-root user account, correct privilege escalation method should be configured in the target servers. Then the <code>ansible_become</code> flag or command parameters <code>--become</code> or <code>-b</code> should be specified.</li></ul><p>Kubespray provides the following utilities to help provision your environment:</p><ul><li><p><a href="https://www.terraform.io/" target="_blank" rel="noreferrer">Terraform</a> scripts for the following cloud providers:</p><ul><li><a href="https://github.com/kubernetes-sigs/kubespray/tree/master/contrib/terraform/aws" target="_blank" rel="noreferrer">AWS</a></li><li><a href="https://github.com/kubernetes-sigs/kubespray/tree/master/contrib/terraform/openstack" target="_blank" rel="noreferrer">OpenStack</a></li><li><a href="https://github.com/kubernetes-sigs/kubespray/tree/master/contrib/terraform/equinix" target="_blank" rel="noreferrer">Equinix Metal</a></li></ul></li></ul><h3 id="_2-5-compose-an-inventory-file" tabindex="-1">(2/5) Compose an inventory file <a class="header-anchor" href="#_2-5-compose-an-inventory-file" aria-label="Permalink to &quot;(2/5) Compose an inventory file&quot;">​</a></h3><p>After you provision your servers, create an <a href="https://docs.ansible.com/ansible/latest/network/getting_started/first_inventory.html" target="_blank" rel="noreferrer">inventory file for Ansible</a>. You can do this manually or via a dynamic inventory script. For more information, see <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/getting-started.md#building-your-own-inventory" target="_blank" rel="noreferrer">&quot;Building your own inventory&quot;</a>.</p><h3 id="_3-5-plan-your-cluster-deployment" tabindex="-1">(3/5) Plan your cluster deployment <a class="header-anchor" href="#_3-5-plan-your-cluster-deployment" aria-label="Permalink to &quot;(3/5) Plan your cluster deployment&quot;">​</a></h3><p>Kubespray provides the ability to customize many aspects of the deployment:</p><ul><li><p>Choice deployment mode: kubeadm or non-kubeadm</p></li><li><p>CNI (networking) plugins</p></li><li><p>DNS configuration</p></li><li><p>Choice of control plane: native/binary or containerized</p></li><li><p>Component versions</p></li><li><p>Calico route reflectors</p></li><li><p>Component runtime options</p><ul><li>Docker</li><li>containerd</li><li>CRI-O</li></ul></li><li><p>Certificate generation methods</p></li></ul><p>Kubespray customizations can be made to a <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html" target="_blank" rel="noreferrer">variable file</a>. If you are getting started with Kubespray, consider using the Kubespray defaults to deploy your cluster and explore Kubernetes.</p><h3 id="_4-5-deploy-a-cluster" tabindex="-1">(4/5) Deploy a Cluster <a class="header-anchor" href="#_4-5-deploy-a-cluster" aria-label="Permalink to &quot;(4/5) Deploy a Cluster&quot;">​</a></h3><p>Next, deploy your cluster:</p><p>Cluster deployment using <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/getting-started.md#starting-custom-deployment" target="_blank" rel="noreferrer">ansible-playbook</a>.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ansible-playbook</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your/inventory/inventory.ini</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster.yml</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-b</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--private-key=</span><span style="color:#F97583;">~</span><span style="color:#79B8FF;">/.ssh/private_key</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ansible-playbook</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your/inventory/inventory.ini</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster.yml</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-b</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--private-key=</span><span style="color:#D73A49;">~</span><span style="color:#005CC5;">/.ssh/private_key</span></span></code></pre></div><p>Large deployments (100+ nodes) may require <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/large-deployments.md" target="_blank" rel="noreferrer">specific adjustments</a> for best results.</p><h3 id="_5-5-verify-the-deployment" tabindex="-1">(5/5) Verify the deployment <a class="header-anchor" href="#_5-5-verify-the-deployment" aria-label="Permalink to &quot;(5/5) Verify the deployment&quot;">​</a></h3><p>Kubespray provides a way to verify inter-pod connectivity and DNS resolve with <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/netcheck.md" target="_blank" rel="noreferrer">Netchecker</a>. Netchecker ensures the netchecker-agents pods can resolve DNS requests and ping each over within the default namespace. Those pods mimic similar behavior as the rest of the workloads and serve as cluster health indicators.</p><h2 id="cluster-operations" tabindex="-1">Cluster operations <a class="header-anchor" href="#cluster-operations" aria-label="Permalink to &quot;Cluster operations&quot;">​</a></h2><p>Kubespray provides additional playbooks to manage your cluster: scale and upgrade.</p><h3 id="scale-your-cluster" tabindex="-1">Scale your cluster <a class="header-anchor" href="#scale-your-cluster" aria-label="Permalink to &quot;Scale your cluster&quot;">​</a></h3><p>You can add worker nodes from your cluster by running the scale playbook. For more information, see <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/getting-started.md#adding-nodes" target="_blank" rel="noreferrer">&quot;Adding nodes&quot;</a>. You can remove worker nodes from your cluster by running the remove-node playbook. For more information, see <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/getting-started.md#remove-nodes" target="_blank" rel="noreferrer">&quot;Remove nodes&quot;</a>.</p><h3 id="upgrade-your-cluster" tabindex="-1">Upgrade your cluster <a class="header-anchor" href="#upgrade-your-cluster" aria-label="Permalink to &quot;Upgrade your cluster&quot;">​</a></h3><p>You can upgrade your cluster by running the upgrade-cluster playbook. For more information, see <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/upgrades.md" target="_blank" rel="noreferrer">&quot;Upgrades&quot;</a>.</p><h2 id="cleanup" tabindex="-1">Cleanup <a class="header-anchor" href="#cleanup" aria-label="Permalink to &quot;Cleanup&quot;">​</a></h2><p>You can reset your nodes and wipe out all components installed with Kubespray via the <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/reset.yml" target="_blank" rel="noreferrer">reset playbook</a>.</p><div class="warning custom-block"><p class="custom-block-title">Caution:</p><p>When running the reset playbook, be sure not to accidentally target your production cluster!</p></div><h2 id="feedback" tabindex="-1">Feedback <a class="header-anchor" href="#feedback" aria-label="Permalink to &quot;Feedback&quot;">​</a></h2><ul><li>Slack Channel: <a href="https://kubernetes.slack.com/messages/kubespray/" target="_blank" rel="noreferrer">#kubespray</a> (You can get your invite <a href="https://slack.k8s.io/" target="_blank" rel="noreferrer">here</a>).</li><li><a href="https://github.com/kubernetes-sigs/kubespray/issues" target="_blank" rel="noreferrer">GitHub Issues</a>.</li></ul><h2 id="what-s-next" tabindex="-1">What&#39;s next <a class="header-anchor" href="#what-s-next" aria-label="Permalink to &quot;What&#39;s next&quot;">​</a></h2><ul><li>Check out planned work on Kubespray&#39;s <a href="https://github.com/kubernetes-sigs/kubespray/blob/master/docs/roadmap.md" target="_blank" rel="noreferrer">roadmap</a>.</li><li>Learn more about <a href="https://github.com/kubernetes-sigs/kubespray" target="_blank" rel="noreferrer">Kubespray</a>.</li></ul>`,38),n=[o];function l(i,p,u,c,d,h){return r(),a("div",null,n)}const m=e(s,[["render",l]]);export{y as __pageData,m as default};
